.js HTTP/1.1" 404 Not Found                   INFO:     172.20.0.1:53972 - "GET /css/support_parent.css HTTP/1.1" 404 Not Found           INFO:     172.20.0.1:49390 - "GET / HTTP/1.1" 404 Not Found                                 root@WOPR:~#                                  root@WOPR:~# # Check what URL it's configured to use for Saleor                             root@WOPR:~# docker inspect printful-sync-printful-sync-1 --format='{{range .Config.Env}}{{println .}}{{end}}' | grep -i -E "saleor|api|url|token|channel"                              SALEOR_TOKEN=dT7ElMxbfBW20sQnRu1WoRQNNwTEv9   PRINTFUL_API_KEY=BkycLM6MDIBjAhOgEpYxkkYPdPMbUeTmhycr75tN                                   root@WOPR:~# # Find where the printful-sync docker-compose or config is                     root@WOPR:~# find /home -name "*printful*" -o -name "docker-compose*" 2>/dev/null | head -20root@WOPR:~#                                  root@WOPR:~# # Or check if it's in a common location                                        root@WOPR:~# ls -la /opt/printful-sync/ 2>/dev/null || ls -la /home/*/printful-sync/ 2>/dev/null                                          total 48                                      drwxr-xr-x  2 root  root   4096 Nov 24 19:12 .drwxr-xr-x 75 caddy caddy  4096 Nov 27 08:27 ..                                             -rw-r--r--  1 root  root  11823 Nov 25 14:41 app.py                                         -rw-r--r--  1 root  root   9811 Nov 24 17:19 app.py.bak                                     -rw-r--r--  1 root  root    389 Nov 24 19:12 docker-compose.yml                             -rw-r--r--  1 root  root    245 Nov 22 04:26 Dockerfile                                     -rw-r--r--  1 root  root    226 Nov 25 14:13 .env                                           -rw-r--r--  1 root  root      0 Nov 24 17:09 except                                         -rw-r--r--  1 root  root     81 Nov 22 04:25 requirements.txt                               -rw-r--r--  1 root  root      0 Nov 24 17:09 try:                                           root@WOPR:~#                                  root@WOPR:~# # Check the .env file            root@WOPR:~# cat /opt/printful-sync/.env      PRINTFUL_API_KEY=BkycLM6MDIBjAhOgEpYxkkYPdPMbUeTmhycr75tN                                   PRINTFUL_STORE_ID=17263844                    SALEOR_API_URL=https://dudeabides.wopr.systems/graphql/                                     SALEOR_TOKEN=dT7ElMxbfBW20sQnRu1WoRQNNwTEv9   PUBLIC_BASE_URL=https://api.wopr.systems      root@WOPR:~#                                  root@WOPR:~# # Check the docker-compose.yml   root@WOPR:~# cat /opt/printful-sync/docker-compose.yml                                      services:                                       printful-sync:                                  build: .                                      restart: unless-stopped                       ports:                                          - "8055:8055"                               networks:                                       - authentik_default                         environment:                                    PRINTFUL_API_KEY: ${PRINTFUL_API_KEY}         PRINTFUL_STORE_ID: ${PRINTFUL_STORE_ID}       SALEOR_TOKEN: ${SALEOR_TOKEN}               command: uvicorn app:app --host 0.0.0.0 --port 8055                                                                                   networks:                                       authentik_default:                              external: true                            root@WOPR:~#                                  root@WOPR:~# # Check what endpoints the app exposes                                         root@WOPR:~# head -100 /opt/printful-sync/app.py                                            import os                                     import requests                               import logging                                from fastapi import FastAPI, Request, Header                                                logging.basicConfig(level=logging.INFO)       logger = logging.getLogger("app")                                                           app = FastAPI()                                                                             SALEOR_API_URL = os.getenv("SALEOR_API_URL", "http://saleor-api-dude:8000/graphql/")        SALEOR_TOKEN = os.getenv("SALEOR_TOKEN")      PRINTFUL_API_KEY = os.getenv("PRINTFUL_API_KEY")                                            PRINTFUL_STORE_ID = os.getenv("PRINTFUL_STORE_ID")                                                                                        # -------------------------------------       # GRAPHQL HELPER                              # -------------------------------------       def saleor_graphql(query, variables=None):        headers = {                                       "Authorization": f"Bearer {SALEOR_TOKEN}",                                                  "Content-Type": "application/json",       }                                             payload = {"query": query, "variables": variables or {}}                                    logger.info("SALEOR REQUEST: %s", payload)    resp = requests.post(                             SALEOR_API_URL,                               json=payload,                                 headers=headers,                              timeout=20,                               )                                                                                           logger.info("SALEOR HTTP %s: %s", resp.status_code, resp.text[:2000])                                                                     try:                                              resp.raise_for_status()                   except requests.HTTPError as e:                   logger.error("Saleor HTTPError: %s | body=%s", e, resp.text)                                raise                                                                                   try:                                              j = resp.json()                           except Exception as e:                            logger.error("Failed to parse Saleor JSON: %s | raw=%r", e, resp.text)                      raise                                                                                   if "errors" in j and j["errors"]:                 logger.error("Saleor GraphQL errors: %s", j["errors"])                                      raise Exception(j["errors"])                                                            return j.get("data")                                                                    # -------------------------------------       # SEO / DESCRIPTION BUILDER                   # -------------------------------------       def build_description(printful_desc: str) -> (str, str):                                        if not printful_desc:                             base = "A comfy design from The Dude Abides Shop."                                      else:                                             d = printful_desc.strip()                     base = (                                          f"{d} — made for folks who dig good vibes, smooth style, "                                  f"and gear that really ties the outfit together, man."                                  )                                         seo = base.replace("\n", " ")[:160]           return base, seo                                                                        # -------------------------------------       # FALLBACK SLUG HANDLER                       # -------------------------------------       def fallback_slug(slug, product, create_query):                                                 new_slug = f"{slug}-dup"                      logger.info(f"Slug conflict: retrying with {new_slug}")                                                                                   res2 = saleor_graphql(                            create_query,                                 {                                                 "input": {                                        "name": product["name"],                      "slug": new_slug,                             "productType": "UHJvZHVjdFR5cGU6MQ==",                                                      "category": "Q2F0ZWdvcnk6MQ==",                                                             "attributes": [],                         }                                         },                                        )                                             pc2 = res2["productCreate"]                   errors2 = pc2.get("errors") or []             if errors2:                                       raise Exception(f"Still failed with alt slug: {errors2}")                                                                             return pc2["product"]["id"]                                                             # -------------------------------------       # CREATE / UPSERT ATTRIBUTE IF NEEDED         # -------------------------------------       def ensure_attribute(slug, name):                 query = """                                   query ($first: Int!) {                          attributes(first: $first) {             root@WOPR:~#                                  root@WOPR:~# # Edit the docker-compose.yml to add SALEOR_API_URL                            root@WOPR:~# cat > /opt/printful-sync/docker-compose.yml << 'EOF'                           > services:                                   >   printful-sync:                            >     build: .                                >     restart: unless-stopped                 >     ports:                                  >       - "8055:8055"                         >     networks:                               >       - authentik_default                   >     environment:                            >       PRINTFUL_API_KEY: ${PRINTFUL_API_KEY} >       PRINTFUL_STORE_ID: ${PRINTFUL_STORE_ID}                                             >       SALEOR_TOKEN: ${SALEOR_TOKEN}         >       SALEOR_API_URL: ${SALEOR_API_URL}     >     command: uvicorn app:app --host 0.0.0.0 --port 8055                                   >                                             > networks:                                   >   authentik_default:                        >     external: true                          > EOF                                         root@WOPR:~# cd /opt/printful-sync            root@WOPR:/opt/printful-sync# docker compose down                                           [+] Running 0/0                               [+] Running 0/1intful-sync-printful-sync-1  St[+] Running 0/1intful-sync-printful-sync-1  St[+] Running 0/1intful-sync-printful-sync-1  St[+] Running 0/1intful-sync-printful-sync-1  St[+] Running 0/1intful-sync-printful-sync-1  St[+] Running 0/1intful-sync-printful-sync-1  St[+] Running 0/1intful-sync-printful-sync-1  St[+] Running 0/1intful-sync-printful-sync-1  St[+] Running 0/1intful-sync-printful-sync-1  St[+] Running 0/1intful-sync-printful-sync-1  St[+] Running 0/1intful-sync-printful-sync-1  St[+] Running 0/1intful-sync-printful-sync-1  St[+] Running 0/1intful-sync-printful-sync-1  St[+] Running 0/1intful-sync-printful-sync-1  St[+] Running 0/1intful-sync-printful-sync-1  St[+] Running 0/1intful-sync-printful-sync-1  St[+] Running 0/1intful-sync-printful-sync-1  St[+] Running 0/1intful-sync-printful-sync-1  St[+] Running 0/1intful-sync-printful-sync-1  St[+] Running 0/1intful-sync-printful-sync-1  St[+] Running 0/1intful-sync-printful-sync-1  St[+] Running 0/1intful-sync-printful-sync-1  St[+] Running 1/1intful-sync-printful-sync-1  Re ✔ Container printful-sync-printful-sync-1  Removed2.3s                                     root@WOPR:/opt/printful-sync# docker compose up -d --build                                  [+] Building 18.3s (10/10) FINISHED docker:default[printful-sync internal] load metad  1.8s  => [printful-sync internal] load build  0.0s  => => transferring dockerfile: 284B     0.0s  => [printful-sync internal] load metad  1.8s  => [printful-sync internal] load .dock  0.0s  => => transferring context: 2B          0.0s  => [printful-sync internal] load build  0.1s  => => transferring context: 22.91kB     0.0s  => [printful-sync 1/5] FROM docker.io/  0.2s  => => resolve docker.io/library/python  0.0s  => => sha256:b43ff04 10.37kB / 10.37kB  0.0s  => => sha256:971f04b35 1.75kB / 1.75kB  0.0s  => => sha256:445121148 5.68kB / 5.68kB  0.0s  => [printful-sync 2/5] WORKDIR /app     0.1s  => [printful-sync 3/5] COPY requiremen  0.1s  => [printful-sync 4/5] RUN pip instal  15.0s  => [printful-sync 5/5] COPY . .         0.1s  => [printful-sync] exporting to image   0.9s  => => exporting layers                  0.9s  => => writing image sha256:e8c823bc10a  0.0s  => => naming to docker.io/library/prin  0.0s [+] Running 0/0                               [+] Running 0/1intful-sync-printful-sync-1  Cr[+] Running 0/1intful-sync-printful-sync-1  St[+] Running 0/1intful-sync-printful-sync-1  St[+] Running 0/1intful-sync-printful-sync-1  St[+] Running 1/1intful-sync-printful-sync-1  St ✔ Container printful-sync-printful-sync-1  Started0.5s                                     root@WOPR:/opt/printful-sync# # Verify the SALEOR_API_URL is now set                        root@WOPR:/opt/printful-sync# docker inspect printful-sync-printful-sync-1 --format='{{range .Config.Env}}{{println .}}{{end}}' | grep -i saleor                                        SALEOR_TOKEN=dT7ElMxbfBW20sQnRu1WoRQNNwTEv9
SALEOR_API_URL=https://dudeabides.wopr.systems/graphql/                                     root@WOPR:/opt/printful-sync#                 root@WOPR:/opt/printful-sync# # Check the logsroot@WOPR:/opt/printful-sync# docker logs printful-sync-printful-sync-1 --tail 20           INFO:     Started server process [1]          INFO:     Waiting for application startup.    INFO:     Application startup complete.       INFO:     Uvicorn running on http://0.0.0.0:8055 (Press CTRL+C to quit)                     root@WOPR:/opt/printful-sync#                 root@WOPR:/opt/printful-sync# # Find all available API endpoints                            root@WOPR:/opt/printful-sync# grep -E "@app\.(get|post)" /opt/printful-sync/app.py
@app.get("/health")                           @app.post("/import/printful/{template_id}")   @app.post("/webhooks/printful")               @app.post("/webhook/printful")                @app.post("/sync")                            root@WOPR:/opt/printful-sync#                 root@WOPR:/opt/printful-sync# # Trigger a manual sync                                       root@WOPR:/opt/printful-sync# curl -X POST http://localhost:8055/sync                       {"synced":1,"results":[{"id":403918567,"status":"error","error":"[{'message': 'To access this path, you need one of the following permissions: MANAGE_PRODUCTS', 'locations': [{'line': 3, 'column': 7}], 'path': ['productCreate'], 'extensions': {'exception': {'code': 'PermissionDenied', 'stacktrace': ['Traceback (most recent call last):', '  File \"/usr/local/lib/python3.12/site-packages/graphql/execution/executor.py\", line 452, in resolve_or_error', '    return executor.execute(resolve_fn, source, info, **args)', '           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^', '  File \"/usr/local/lib/python3.12/site-packages/graphql/execution/executors/sync.py\", line 16, in execute', '    return fn(*args, **kwargs)', '           ^^^^^^^^^^^^^^^^^^^', '  File \"/usr/local/lib/python3.12/contextlib.py\", line 81, in inner', '    return func(*args, **kwds)', '           ^^^^^^^^^^^^^^^^^^^', '  File \"/app/saleor/graphql/core/mutations.py\", line 522, in mutate', '    raise PermissionDenied(permissions=cls._meta.permissions)', 'saleor.core.exceptions.PermissionDenied: To access this path, you need one of the following permissions: MANAGE_PRODUCTS']}}}]"}]}root@WOPR:/opt/printful-sync#                                        root@WOPR:/opt/printful-sync# # Then check the logs to see what happened                    root@WOPR:/opt/printful-sync# docker logs printful-sync-printful-sync-1 --tail 50           INFO:     Started server process [1]          INFO:     Waiting for application startup.    INFO:     Application startup complete.       INFO:     Uvicorn running on http://0.0.0.0:8055 (Press CTRL+C to quit)                     INFO:app:Starting full Printful sync          INFO:app:Importing Printful template 403918567INFO:app:SALEOR REQUEST: {'query': '\n    mutation CreateProduct($input: ProductCreateInput!) {\n      productCreate(input: $input) {\n        product { id name slug }\n        errors { field message }\n      }\n    }\n    ', 'variables': {'input': {'name': 'Snapback Hat', 'slug': 'printful-403918567', 'seo': {'title': 'Snapback Hat', 'description': 'Snapback Hat — made for folks who dig good vibes, smooth style, and gear that really ties the outfit together, man.'}, 'productType': 'UHJvZHVjdFR5cGU6MQ==', 'category': 'Q2F0ZWdvcnk6MQ==', 'attributes': []}}}                                    INFO:app:SALEOR HTTP 200: {"errors": [{"message": "To access this path, you need one of the following permissions: MANAGE_PRODUCTS", "locations": [{"line": 3, "column": 7}], "path": ["productCreate"], "extensions": {"exception": {"code": "PermissionDenied", "stacktrace": ["Traceback (most recent call last):", "  File \"/usr/local/lib/python3.12/site-packages/graphql/execution/executor.py\", line 452, in resolve_or_error", "    return executor.execute(resolve_fn, source, info, **args)", "           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^", "  File \"/usr/local/lib/python3.12/site-packages/graphql/execution/executors/sync.py\", line 16, in execute", "    return fn(*args, **kwargs)", "           ^^^^^^^^^^^^^^^^^^^", "  File \"/usr/local/lib/python3.12/contextlib.py\", line 81, in inner", "    return func(*args, **kwds)", "           ^^^^^^^^^^^^^^^^^^^", "  File \"/app/saleor/graphql/core/mutations.py\", line 522, in mutate", "    raise PermissionDenied(permissions=cls._meta.permissions)", "saleor.core.exceptions.PermissionDenied: To access this path, you need one of the following permissions: MANAGE_PRODUCTS"]}}}], "data": {"productCreate": null}, "extensions": {"cost": {"requestedQueryCost": 0, "maximumAvailable": 50000}}}                                   ERROR:app:Saleor GraphQL errors: [{'message': 'To access this path, you need one of the following permissions: MANAGE_PRODUCTS', 'locations': [{'line': 3, 'column': 7}], 'path': ['productCreate'], 'extensions': {'exception': {'code': 'PermissionDenied', 'stacktrace': ['Traceback (most recent call last):', '  File "/usr/local/lib/python3.12/site-packages/graphql/execution/executor.py", line 452, in resolve_or_error', '    return executor.execute(resolve_fn, source, info, **args)', '           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^', '  File "/usr/local/lib/python3.12/site-packages/graphql/execution/executors/sync.py", line 16, in execute', '    return fn(*args, **kwargs)', '           ^^^^^^^^^^^^^^^^^^^', '  File "/usr/local/lib/python3.12/contextlib.py", line 81, in inner', '    return func(*args, **kwds)', '           ^^^^^^^^^^^^^^^^^^^', '  File "/app/saleor/graphql/core/mutations.py", line 522, in mutate', '    raise PermissionDenied(permissions=cls._meta.permissions)', 'saleor.core.exceptions.PermissionDenied: To access this path, you need one of the following permissions: MANAGE_PRODUCTS']}}}]                     ERROR:app:Failed to import 403918567: [{'message': 'To access this path, you need one of the following permissions: MANAGE_PRODUCTS', 'locations': [{'line': 3, 'column': 7}], 'path': ['productCreate'], 'extensions': {'exception': {'code': 'PermissionDenied', 'stacktrace': ['Traceback (most recent call last):', '  File "/usr/local/lib/python3.12/site-packages/graphql/execution/executor.py", line 452, in resolve_or_error', '    return executor.execute(resolve_fn, source, info, **args)', '           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^', '  File "/usr/local/lib/python3.12/site-packages/graphql/execution/executors/sync.py", line 16, in execute', '    return fn(*args, **kwargs)', '           ^^^^^^^^^^^^^^^^^^^', '  File "/usr/local/lib/python3.12/contextlib.py", line 81, in inner', '    return func(*args, **kwds)', '           ^^^^^^^^^^^^^^^^^^^', '  File "/app/saleor/graphql/core/mutations.py", line 522, in mutate', '    raise PermissionDenied(permissions=cls._meta.permissions)', 'saleor.core.exceptions.PermissionDenied: To access this path, you need one of the following permissions: MANAGE_PRODUCTS']}}}]                INFO:     172.20.0.1:58012 - "POST /sync HTTP/1.1" 200 OK                                   root@WOPR:/opt/printful-sync#