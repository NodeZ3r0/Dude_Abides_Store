;for(let d=0;d<g;d++)h.dataTypeIDs[d]=this.reader.int32();return h}parseDataRowMessage(l,f,m){this.reader.setBuffer(l,m);let g=this.reader.int16(),h=new Array(g);for(let d=0;d<g;d++){let y=this.reader.int32();h[d]=y===-1?null:this.reader.string(y)}return new e.DataRowMessage(f,h)}parseParameterStatusMessage(l,f,m){this.reader.setBuffer(l,m);let g=this.reader.cstring(),h=this.reader.cstring();return new e.ParameterStatusMessage(f,g,h)}parseBackendKeyData(l,f,m){this.reader.setBuffer(l,m);let g=this.reader.int32(),h=this.reader.int32();return new e.BackendKeyDataMessage(f,g,h)}parseAuthenticationResponse(l,f,m){this.reader.setBuffer(l,m);let g=this.reader.int32(),h={name:"authenticationOk",length:f};switch(g){case 0:break;case 3:h.length===8&&(h.name="authenticationCleartextPassword");break;case 5:if(h.length===12){h.name="authenticationMD5Password";let y=this.reader.bytes(4);return new e.AuthenticationMD5Password(f,y)}break;case 10:h.name="authenticationSASL",h.mechanisms=[];let d;do d=this.reader.cstring(),d&&h.mechanisms.push(d);while(d);break;case 11:h.name="authenticationSASLContinue",h.data=this.reader.string(f-8);break;case 12:h.name="authenticationSASLFinal",h.data=this.reader.string(f-8);break;default:throw new Error("Unknown authenticationOk message type "+g)}return h}parseErrorMessage(l,f,m,g){this.reader.setBuffer(l,m);let h={},d=this.reader.string(1);for(;d!=="\0";)h[d]=this.reader.cstring(),d=this.reader.string(1);let y=h.M,w=g==="notice"?new e.NoticeMessage(f,y):new e.DatabaseError(y,f,g);return w.severity=h.S,w.code=h.C,w.detail=h.D,w.hint=h.H,w.position=h.P,w.internalPosition=h.p,w.internalQuery=h.q,w.where=h.W,w.schema=h.s,w.table=h.t,w.column=h.c,w.dataType=h.d,w.constraint=h.n,w.file=h.F,w.line=h.L,w.routine=h.R,w}};b(o,"Parser");var c=o;t.Parser=c}),E2=pe(t=>{"use strict";te(),Object.defineProperty(t,"__esModule",{value:!0}),t.DatabaseError=t.serialize=t.parse=void 0;var e=S2();Object.defineProperty(t,"DatabaseError",{enumerable:!0,get:b(function(){return e.DatabaseError},"get")});var r=AI();Object.defineProperty(t,"serialize",{enumerable:!0,get:b(function(){return r.serialize},"get")});var n=NI();function i(a,s){let o=new n.Parser;return a.on("data",c=>o.parse(c,s)),new Promise(c=>a.on("end",()=>c()))}b(i,"parse"),t.parse=i}),k2={};Zt(k2,{connect:()=>C2});function C2({socket:t,servername:e}){return t.startTls(e),t}var II=_t(()=>{"use strict";te(),b(C2,"connect")}),T2=pe((t,e)=>{"use strict";te();var r=(Dm(),tt(w2)),n=Wn().EventEmitter,{parse:i,serialize:a}=E2(),s=a.flush(),o=a.sync(),c=a.end(),u=class extends n{constructor(m){super(),m=m||{},this.stream=m.stream||new r.Socket,this._keepAlive=m.keepAlive,this._keepAliveInitialDelayMillis=m.keepAliveInitialDelayMillis,this.lastBuffer=!1,this.parsedStatements={},this.ssl=m.ssl||!1,this._ending=!1,this._emitMessage=!1;var g=this;this.on("newListener",function(h){h==="message"&&(g._emitMessage=!0)})}connect(m,g){var h=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(m,g),this.stream.once("connect",function(){h._keepAlive&&h.stream.setKeepAlive(!0,h._keepAliveInitialDelayMillis),h.emit("connect")});let d=b(function(y){h._ending&&(y.code==="ECONNRESET"||y.code==="EPIPE")||h.emit("error",y)},"reportStreamError");if(this.stream.on("error",d),this.stream.on("close",function(){h.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(y){var w=y.toString("utf8");switch(w){case"S":break;case"N":return h.stream.end(),h.emit("error",new Error("The server does not support SSL connections"));default:return h.stream.end(),h.emit("error",new Error("There was an error establishing an SSL connection"))}var S=(II(),tt(k2));let _={socket:h.stream};h.ssl!==!0&&(Object.assign(_,h.ssl),"key"in h.ssl&&(_.key=h.ssl.key)),r.isIP(g)===0&&(_.servername=g);try{h.stream=S.connect(_)}catch(I){return h.emit("error",I)}h.attachListeners(h.stream),h.stream.on("error",d),h.emit("sslconnect")})}attachListeners(m){m.on("end",()=>{this.emit("end")}),i(m,g=>{var h=g.name==="error"?"errorMessage":g.name;this._emitMessage&&this.emit("message",g),this.emit(h,g)})}requestSsl(){this.stream.write(a.requestSsl())}startup(m){this.stream.write(a.startup(m))}cancel(m,g){this._send(a.cancel(m,g))}password(m){this._send(a.password(m))}sendSASLInitialResponseMessage(m,g){this._send(a.sendSASLInitialResponseMessage(m,g))}sendSCRAMClientFinalMessage(m){this._send(a.sendSCRAMClientFinalMessage(m))}_send(m){return this.stream.writable?this.stream.write(m):!1}query(m){this._send(a.query(m))}parse(m){this._send(a.parse(m))}bind(m){this._send(a.bind(m))}execute(m){this._send(a.execute(m))}flush(){this.stream.writable&&this.stream.write(s)}sync(){this._ending=!0,this._send(s),this._send(o)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){if(this._ending=!0,!this._connecting||!this.stream.writable){this.stream.end();return}return this.stream.write(c,()=>{this.stream.end()})}close(m){this._send(a.close(m))}describe(m){this._send(a.describe(m))}sendCopyFromChunk(m){this._send(a.copyData(m))}endCopyFrom(){this._send(a.copyDone())}sendCopyFail(m){this._send(a.copyFail(m))}};b(u,"Connection");var l=u;e.exports=l}),OI=pe((t,e)=>{"use strict";te();var r=Wn().EventEmitter,n=($c(),tt(gs)),i=Qc(),a=yI(),s=_I(),o=Lm(),c=Mm(),u=CI(),l=zc(),f=T2(),m=class extends r{constructor(d){super(),this.connectionParameters=new c(d),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;var y=d||{};this._Promise=y.Promise||Fc.Promise,this._types=new o(y.types),this._ending=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.connection=y.connection||new f({stream:y.stream,ssl:this.connectionParameters.ssl,keepAlive:y.keepAlive||!1,keepAliveInitialDelayMillis:y.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=y.binary||l.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=y.connectionTimeoutMillis||0}_errorAllQueries(d){let y=b(w=>{le.nextTick(()=>{w.handleError(d,this.connection)})},"enqueueError");this.activeQuery&&(y(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(y),this.queryQueue.length=0}_connect(d){var y=this,w=this.connection;if(this._connectionCallback=d,this._connecting||this._connected){let S=new Error("Client has already been connected. You cannot reuse a client.");le.nextTick(()=>{d(S)});return}this._connecting=!0,this.connectionTimeoutHandle,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{w._ending=!0,w.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis)),this.host&&this.host.indexOf("/")===0?w.connect(this.host+"/.s.PGSQL."+this.port):w.connect(this.port,this.host),w.on("connect",function(){y.ssl?w.requestSsl():w.startup(y.getStartupConf())}),w.on("sslconnect",function(){w.startup(y.getStartupConf())}),this._attachListeners(w),w.once("end",()=>{let S=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(S),this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(S):this._handleErrorEvent(S):this._connectionError||this._handleErrorEvent(S)),le.nextTick(()=>{this.emit("end")})})}connect(d){if(d){this._connect(d);return}return new this._Promise((y,w)=>{this._connect(S=>{S?w(S):y()})})}_attachListeners(d){d.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),d.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),d.on("authenticationSASL",this._handleAuthSASL.bind(this)),d.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),d.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),d.on("backendKeyData",this._handleBackendKeyData.bind(this)),d.on("error",this._handleErrorEvent.bind(this)),d.on("errorMessage",this._handleErrorMessage.bind(this)),d.on("readyForQuery",this._handleReadyForQuery.bind(this)),d.on("notice",this._handleNotice.bind(this)),d.on("rowDescription",this._handleRowDescription.bind(this)),d.on("dataRow",this._handleDataRow.bind(this)),d.on("portalSuspended",this._handlePortalSuspended.bind(this)),d.on("emptyQuery",this._handleEmptyQuery.bind(this)),d.on("commandComplete",this._handleCommandComplete.bind(this)),d.on("parseComplete",this._handleParseComplete.bind(this)),d.on("copyInResponse",this._handleCopyInResponse.bind(this)),d.on("copyData",this._handleCopyData.bind(this)),d.on("notification",this._handleNotification.bind(this))}_checkPgPass(d){let y=this.connection;typeof this.password=="function"?this._Promise.resolve().then(()=>this.password()).then(w=>{if(w!==void 0){if(typeof w!="string"){y.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=w}else this.connectionParameters.password=this.password=null;d()}).catch(w=>{y.emit("error",w)}):this.password!==null?d():s(this.connectionParameters,w=>{w!==void 0&&(this.connectionParameters.password=this.password=w),d()})}_handleAuthCleartextPassword(d){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(d){this._checkPgPass(()=>{let y=i.postgresMd5PasswordHash(this.user,this.password,d.salt);this.connection.password(y)})}_handleAuthSASL(d){this._checkPgPass(()=>{this.saslSession=a.startSession(d.mechanisms),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)})}_handleAuthSASLContinue(d){a.continueSession(this.saslSession,this.password,d.data),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}_handleAuthSASLFinal(d){a.finalizeSession(this.saslSession,d.data),this.saslSession=null}_handleBackendKeyData(d){this.processID=d.processID,this.secretKey=d.secretKey}_handleReadyForQuery(d){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:y}=this;this.activeQuery=null,this.readyForQuery=!0,y&&y.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(d){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(d);this.emit("error",d)}}_handleErrorEvent(d){if(this._connecting)return this._handleErrorWhileConnecting(d);this._queryable=!1,this._errorAllQueries(d),this.emit("error",d)}_handleErrorMessage(d){if(this._connecting)return this._handleErrorWhileConnecting(d);let y=this.activeQuery;if(!y){this._handleErrorEvent(d);return}this.activeQuery=null,y.handleError(d,this.connection)}_handleRowDescription(d){this.activeQuery.handleRowDescription(d)}_handleDataRow(d){this.activeQuery.handleDataRow(d)}_handlePortalSuspended(d){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(d){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(d){this.activeQuery.handleCommandComplete(d,this.connection)}_handleParseComplete(d){this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(d){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(d){this.activeQuery.handleCopyData(d,this.connection)}_handleNotification(d){this.emit("notification",d)}_handleNotice(d){this.emit("notice",d)}getStartupConf(){var d=this.connectionParameters,y={user:d.user,database:d.database},w=d.application_name||d.fallback_application_name;return w&&(y.application_name=w),d.replication&&(y.replication=""+d.replication),d.statement_timeout&&(y.statement_timeout=String(parseInt(d.statement_timeout,10))),d.lock_timeout&&(y.lock_timeout=String(parseInt(d.lock_timeout,10))),d.idle_in_transaction_session_timeout&&(y.idle_in_transaction_session_timeout=String(parseInt(d.idle_in_transaction_session_timeout,10))),d.options&&(y.options=d.options),y}cancel(d,y){if(d.activeQuery===y){var w=this.connection;this.host&&this.host.indexOf("/")===0?w.connect(this.host+"/.s.PGSQL."+this.port):w.connect(this.port,this.host),w.on("connect",function(){w.cancel(d.processID,d.secretKey)})}else d.queryQueue.indexOf(y)!==-1&&d.queryQueue.splice(d.queryQueue.indexOf(y),1)}setTypeParser(d,y,w){return this._types.setTypeParser(d,y,w)}getTypeParser(d,y){return this._types.getTypeParser(d,y)}escapeIdentifier(d){return'"'+d.replace(/"/g,'""')+'"'}escapeLiteral(d){for(var y=!1,w="'",S=0;S<d.length;S++){var _=d[S];_==="'"?w+=_+_:_==="\\"?(w+=_+_,y=!0):w+=_}return w+="'",y===!0&&(w=" E"+w),w}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let d=this.activeQuery.submit(this.connection);d&&le.nextTick(()=>{this.activeQuery.handleError(d,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(d,y,w){var S,_,I,j,E;if(d==null)throw new TypeError("Client was passed a null or undefined query");return typeof d.submit=="function"?(I=d.query_timeout||this.connectionParameters.query_timeout,_=S=d,typeof y=="function"&&(S.callback=S.callback||y)):(I=this.connectionParameters.query_timeout,S=new u(d,y,w),S.callback||(_=new this._Promise((T,N)=>{S.callback=(C,L)=>C?N(C):T(L)}))),I&&(E=S.callback,j=setTimeout(()=>{var T=new Error("Query read timeout");le.nextTick(()=>{S.handleError(T,this.connection)}),E(T),S.callback=()=>{};var N=this.queryQueue.indexOf(S);N>-1&&this.queryQueue.splice(N,1),this._pulseQueryQueue()},I),S.callback=(T,N)=>{clearTimeout(j),E(T,N)}),this.binary&&!S.binary&&(S.binary=!0),S._result&&!S._result._types&&(S._result._types=this._types),this._queryable?this._ending?(le.nextTick(()=>{S.handleError(new Error("Client was closed and is not queryable"),this.connection)}),_):(this.queryQueue.push(S),this._pulseQueryQueue(),_):(le.nextTick(()=>{S.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),_)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(d){if(this._ending=!0,!this.connection._connecting)if(d)d();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),d)this.connection.once("end",d);else return new this._Promise(y=>{this.connection.once("end",y)})}};b(m,"Client");var g=m;g.Query=u,e.exports=g}),qI=pe((t,e)=>{"use strict";te();var r=Wn().EventEmitter,n=b(function(){},"NOOP"),i=b((h,d)=>{let y=h.findIndex(d);return y===-1?void 0:h.splice(y,1)[0]},"removeWhere"),a=class{constructor(d,y,w){this.client=d,this.idleListener=y,this.timeoutId=w}};b(a,"IdleItem");var s=a,o=class{constructor(d){this.callback=d}};b(o,"PendingItem");var c=o;function u(){throw new Error("Release called on client which has already been released to the pool.")}b(u,"throwOnDoubleRelease");function l(h,d){if(d)return{callback:d,result:void 0};let y,w,S=b(function(I,j){I?y(I):w(j)},"cb"),_=new h(function(I,j){w=I,y=j}).catch(I=>{throw Error.captureStackTrace(I),I});return{callback:S,result:_}}b(l,"promisify");function f(h,d){return b(function y(w){w.client=d,d.removeListener("error",y),d.on("error",()=>{h.log("additional client error after disconnection due to error",w)}),h._remove(d),h.emit("error",w,d)},"idleListener")}b(f,"makeIdleListener");var m=class extends r{constructor(d,y){super(),this.options=Object.assign({},d),d!=null&&"password"in d&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:d.password}),d!=null&&d.ssl&&d.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||y||Fm().Client,this.Promise=this.options.Promise||Fc.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(y=>{this._remove(y.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let d=this._pendingQueue.shift();if(this._idle.length){let y=this._idle.pop();clearTimeout(y.timeoutId);let w=y.client;w.ref&&w.ref();let S=y.idleListener;return this._acquireClient(w,d,S,!1)}if(!this._isFull())return this.newClient(d);throw new Error("unexpected condition")}_remove(d){let y=i(this._idle,w=>w.client===d);y!==void 0&&clearTimeout(y.timeoutId),this._clients=this._clients.filter(w=>w!==d),d.end(),this.emit("remove",d)}connect(d){if(this.ending){let S=new Error("Cannot use a pool after calling end on the pool");return d?d(S):this.Promise.reject(S)}let y=l(this.Promise,d),w=y.result;if(this._isFull()||this._idle.length){if(this._idle.length&&le.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new c(y.callback)),w;let S=b((j,E,T)=>{clearTimeout(I),y.callback(j,E,T)},"queueCallback"),_=new c(S),I=setTimeout(()=>{i(this._pendingQueue,j=>j.callback===S),_.timedOut=!0,y.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return this._pendingQueue.push(_),w}return this.newClient(new c(y.callback)),w}newClient(d){let y=new this.Client(this.options);this._clients.push(y);let w=f(this,y);this.log("checking client timeout");let S,_=!1;this.options.connectionTimeoutMillis&&(S=setTimeout(()=>{this.log("ending client due to timeout"),_=!0,y.connection?y.connection.stream.destroy():y.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),y.connect(I=>{if(S&&clearTimeout(S),y.on("error",w),I)this.log("client failed to connect",I),this._clients=this._clients.filter(j=>j!==y),_&&(I.message="Connection terminated due to connection timeout"),this._pulseQueue(),d.timedOut||d.callback(I,void 0,n);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let j=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(y),this._idle.findIndex(E=>E.client===y)!==-1&&this._acquireClient(y,new c((E,T,N)=>N()),w,!1)},this.options.maxLifetimeSeconds*1e3);j.unref(),y.once("end",()=>clearTimeout(j))}return this._acquireClient(y,d,w,!0)}})}_acquireClient(d,y,w,S){S&&this.emit("connect",d),this.emit("acquire",d),d.release=this._releaseOnce(d,w),d.removeListener("error",w),y.timedOut?S&&this.options.verify?this.options.verify(d,d.release):d.release():S&&this.options.verify?this.options.verify(d,_=>{if(_)return d.release(_),y.callback(_,void 0,n);y.callback(void 0,d,d.release)}):y.callback(void 0,d,d.release)}_releaseOnce(d,y){let w=!1;return S=>{w&&u(),w=!0,this._release(d,y,S)}}_release(d,y,w){if(d.on("error",y),d._poolUseCount=(d._poolUseCount||0)+1,this.emit("release",w,d),w||this.ending||!d._queryable||d._ending||d._poolUseCount>=this.options.maxUses){d._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(d),this._pulseQueue();return}if(this._expired.has(d)){this.log("remove expired client"),this._expired.delete(d),this._remove(d),this._pulseQueue();return}let S;this.options.idleTimeoutMillis&&(S=setTimeout(()=>{this.log("remove idle client"),this._remove(d)},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&S.unref()),this.options.allowExitOnIdle&&d.unref(),this._idle.push(new s(d,y,S)),this._pulseQueue()}query(d,y,w){if(typeof d=="function"){let _=l(this.Promise,d);return Im(function(){return _.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),_.result}typeof y=="function"&&(w=y,y=void 0);let S=l(this.Promise,w);return w=S.callback,this.connect((_,I)=>{if(_)return w(_);let j=!1,E=b(T=>{j||(j=!0,I.release(T),w(T))},"onError");I.once("error",E),this.log("dispatching query");try{I.query(d,y,(T,N)=>{if(this.log("query dispatched"),I.removeListener("error",E),!j)return j=!0,I.release(T),T?w(T):w(void 0,N)})}catch(T){return I.release(T),w(T)}}),S.result}end(d){if(this.log("ending"),this.ending){let w=new Error("Called end on pool more than once");return d?d(w):this.Promise.reject(w)}this.ending=!0;let y=l(this.Promise,d);return this._endCallback=y.callback,this._pulseQueue(),y.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((d,y)=>d+(this._expired.has(y)?1:0),0)}get totalCount(){return this._clients.length}};b(m,"Pool");var g=m;e.exports=g}),A2={};Zt(A2,{default:()=>P2});var P2,jI=_t(()=>{"use strict";te(),P2={}}),RI=pe((t,e)=>{e.exports={name:"pg",version:"8.8.0",description:"PostgreSQL client - pure javascript & libpq with the same API",keywords:["database","libpq","pg","postgre","postgres","postgresql","rdbms"],homepage:"https://github.com/brianc/node-postgres",repository:{type:"git",url:"git://github.com/brianc/node-postgres.git",directory:"packages/pg"},author:"Brian Carlson <brian.m.carlson@gmail.com>",main:"./lib",dependencies:{"buffer-writer":"2.0.0","packet-reader":"1.0.0","pg-connection-string":"^2.5.0","pg-pool":"^3.5.2","pg-protocol":"^1.5.0","pg-types":"^2.1.0",pgpass:"1.x"},devDependencies:{async:"2.6.4",bluebird:"3.5.2",co:"4.6.0","pg-copy-streams":"0.3.0"},peerDependencies:{"pg-native":">=3.0.1"},peerDependenciesMeta:{"pg-native":{optional:!0}},scripts:{test:"make test-all"},files:["lib","SPONSORS.md"],license:"MIT",engines:{node:">= 8.0.0"},gitHead:"c99fb2c127ddf8d712500db2c7b9a5491a178655"}}),LI=pe((t,e)=>{"use strict";te();var r=Wn().EventEmitter,n=($c(),tt(gs)),i=Qc(),a=e.exports=function(o,c,u){r.call(this),o=i.normalizeQueryConfig(o,c,u),this.text=o.text,this.values=o.values,this.name=o.name,this.callback=o.callback,this.state="new",this._arrayMode=o.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(l){l==="row"&&(this._emitRowEvents=!0)}.bind(this))};n.inherits(a,r);var s={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};a.prototype.handleError=function(o){var c=this.native.pq.resultErrorFields();if(c)for(var u in c){var l=s[u]||u;o[l]=c[u]}this.callback?this.callback(o):this.emit("error",o),this.state="error"},a.prototype.then=function(o,c){return this._getPromise().then(o,c)},a.prototype.catch=function(o){return this._getPromise().catch(o)},a.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(o,c){this._once("end",o),this._once("error",c)}.bind(this)),this._promise)},a.prototype.submit=function(o){this.state="running";var c=this;this.native=o.native,o.native.arrayMode=this._arrayMode;var u=b(function(m,g,h){if(o.native.arrayMode=!1,Im(function(){c.emit("_done")}),m)return c.handleError(m);c._emitRowEvents&&(h.length>1?g.forEach((d,y)=>{d.forEach(w=>{c.emit("row",w,h[y])})}):g.forEach(function(d){c.emit("row",d,h)})),c.state="end",c.emit("end",h),c.callback&&c.callback(null,h)},"after");if(le.domain&&(u=le.domain.bind(u)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));var l=(this.values||[]).map(i.prepareValue);if(o.namedQueries[this.name]){if(this.text&&o.namedQueries[this.name]!==this.text){let m=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return u(m)}return o.native.execute(this.name,l,u)}return o.native.prepare(this.name,this.text,l.length,function(m){return m?u(m):(o.namedQueries[c.name]=c.text,c.native.execute(c.name,l,u))})}else if(this.values){if(!Array.isArray(this.values)){let m=new Error("Query values must be an array");return u(m)}var f=this.values.map(i.prepareValue);o.native.query(this.text,f,u)}else o.native.query(this.text,u)}}),BI=pe((t,e)=>{"use strict";te();var r=(jI(),tt(A2)),n=Lm(),i=RI(),a=Wn().EventEmitter,s=($c(),tt(gs)),o=Mm(),c=LI(),u=e.exports=function(l){a.call(this),l=l||{},this._Promise=l.Promise||Fc.Promise,this._types=new n(l.types),this.native=new r({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;var f=this.connectionParameters=new o(l);this.user=f.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:f.password}),this.database=f.database,this.host=f.host,this.port=f.port,this.namedQueries={}};u.Query=c,s.inherits(u,a),u.prototype._errorAllQueries=function(l){let f=b(m=>{le.nextTick(()=>{m.native=this.native,m.handleError(l)})},"enqueueError");this._hasActiveQuery()&&(f(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(f),this._queryQueue.length=0},u.prototype._connect=function(l){var f=this;if(this._connecting){le.nextTick(()=>l(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(m,g){if(m)return l(m);f.native.connect(g,function(h){if(h)return f.native.end(),l(h);f._connected=!0,f.native.on("error",function(d){f._queryable=!1,f._errorAllQueries(d),f.emit("error",d)}),f.native.on("notification",function(d){f.emit("notification",{channel:d.relname,payload:d.extra})}),f.emit("connect"),f._pulseQueryQueue(!0),l()})})},u.prototype.connect=function(l){if(l){this._connect(l);return}return new this._Promise((f,m)=>{this._connect(g=>{g?m(g):f()})})},u.prototype.query=function(l,f,m){var g,h,d,y,w;if(l==null)throw new TypeError("Client was passed a null or undefined query");if(typeof l.submit=="function")d=l.query_timeout||this.connectionParameters.query_timeout,h=g=l,typeof f=="function"&&(l.callback=f);else if(d=this.connectionParameters.query_timeout,g=new c(l,f,m),!g.callback){let S,_;h=new this._Promise((I,j)=>{S=I,_=j}),g.callback=(I,j)=>I?_(I):S(j)}return d&&(w=g.callback,y=setTimeout(()=>{var S=new Error("Query read timeout");le.nextTick(()=>{g.handleError(S,this.connection)}),w(S),g.callback=()=>{};var _=this._queryQueue.indexOf(g);_>-1&&this._queryQueue.splice(_,1),this._pulseQueryQueue()},d),g.callback=(S,_)=>{clearTimeout(y),w(S,_)}),this._queryable?this._ending?(g.native=this.native,le.nextTick(()=>{g.handleError(new Error("Client was closed and is not queryable"))}),h):(this._queryQueue.push(g),this._pulseQueryQueue(),h):(g.native=this.native,le.nextTick(()=>{g.handleError(new Error("Client has encountered a connection error and is not queryable"))}),h)},u.prototype.end=function(l){var f=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,l));var m;return l||(m=new this._Promise(function(g,h){l=b(d=>d?h(d):g(),"cb")})),this.native.end(function(){f._errorAllQueries(new Error("Connection terminated")),le.nextTick(()=>{f.emit("end"),l&&l()})}),m},u.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"},u.prototype._pulseQueryQueue=function(l){if(this._connected&&!this._hasActiveQuery()){var f=this._queryQueue.shift();if(!f){l||this.emit("drain");return}this._activeQuery=f,f.submit(this);var m=this;f.once("_done",function(){m._pulseQueryQueue()})}},u.prototype.cancel=function(l){this._activeQuery===l?this.native.cancel(function(){}):this._queryQueue.indexOf(l)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(l),1)},u.prototype.ref=function(){},u.prototype.unref=function(){},u.prototype.setTypeParser=function(l,f,m){return this._types.setTypeParser(l,f,m)},u.prototype.getTypeParser=function(l,f){return this._types.getTypeParser(l,f)}}),JS=pe((t,e)=>{"use strict";te(),e.exports=BI()}),Fm=pe((t,e)=>{"use strict";te();var r=OI(),n=zc(),i=T2(),a=qI(),{DatabaseError:s}=E2(),o=b(u=>{var l;return l=class extends a{constructor(f){super(f,u)}},b(l,"BoundPool"),l},"poolFactory"),c=b(function(u){this.defaults=n,this.Client=u,this.Query=this.Client.Query,this.Pool=o(this.Client),this._pools=[],this.Connection=i,this.types=Uc(),this.DatabaseError=s},"PG");typeof le.env.NODE_PG_FORCE_NATIVE<"u"?e.exports=new c(JS()):(e.exports=new c(r),Object.defineProperty(e.exports,"native",{configurable:!0,enumerable:!1,get(){var u=null;try{u=new c(JS())}catch(l){if(l.code!=="MODULE_NOT_FOUND")throw l}return Object.defineProperty(e.exports,"native",{value:u}),u}}))});te();var N2=Wi(Fm());Dm();te();Dm();b2();var MI=Wi(Qc()),DI=Wi(Lm());function I2(t){return t instanceof se?"\\x"+t.toString("hex"):t}b(I2,"encodeBuffersAsBytea");var O2=class q2 extends Error{constructor(e){super(e),oe(this,"name","NeonDbError"),oe(this,"severity"),oe(this,"code"),oe(this,"detail"),oe(this,"hint"),oe(this,"position"),oe(this,"internalPosition"),oe(this,"internalQuery"),oe(this,"where"),oe(this,"schema"),oe(this,"table"),oe(this,"column"),oe(this,"dataType"),oe(this,"constraint"),oe(this,"file"),oe(this,"line"),oe(this,"routine"),oe(this,"sourceError"),"captureStackTrace"in Error&&typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,q2)}};b(O2,"NeonDbError");var Vi=O2,YS="transaction() expects an array of queries, or a function returning an array of queries",FI=["severity","code","detail","hint","position","internalPosition","internalQuery","where","schema","table","column","dataType","constraint","file","line","routine"];function j2(t,{arrayMode:e,fullResults:r,fetchOptions:n,isolationLevel:i,readOnly:a,deferrable:s,queryCallback:o,resultCallback:c,authToken:u}={}){if(!t)throw new Error("No database connection string was provided to `neon()`. Perhaps an environment variable has not been set?");let l;try{l=Bm(t)}catch{throw new Error("Database connection string provided to `neon()` is not a valid URL. Connection string: "+String(t))}let{protocol:f,username:m,hostname:g,port:h,pathname:d}=l;if(f!=="postgres:"&&f!=="postgresql:"||!m||!g||!d)throw new Error("Database connection string format for `neon()` should be: postgresql://user:password@host.tld/dbname?option=value");function y(S,..._){let I,j;if(typeof S=="string")I=S,j=_[1],_=_[0]??[];else{I="";for(let T=0;T<S.length;T++)I+=S[T],T<_.length&&(I+="$"+(T+1))}_=_.map(T=>I2((0,MI.prepareValue)(T)));let E={query:I,params:_};return o&&o(E),R2(w,E,j)}b(y,"resolve"),y.transaction=async(S,_)=>{if(typeof S=="function"&&(S=S(y)),!Array.isArray(S))throw new Error(YS);S.forEach(E=>{if(E[Symbol.toStringTag]!=="NeonQueryPromise")throw new Error(YS)});let I=S.map(E=>E.parameterizedQuery),j=S.map(E=>E.opts??{});return w(I,j,_)};async function w(S,_,I){let{fetchEndpoint:j,fetchFunction:E}=fn,T=Array.isArray(S)?{queries:S}:S,N=n??{},C=e??!1,L=r??!1,B=i,K=a,H=s;I!==void 0&&(I.fetchOptions!==void 0&&(N={...N,...I.fetchOptions}),I.arrayMode!==void 0&&(C=I.arrayMode),I.fullResults!==void 0&&(L=I.fullResults),I.isolationLevel!==void 0&&(B=I.isolationLevel),I.readOnly!==void 0&&(K=I.readOnly),I.deferrable!==void 0&&(H=I.deferrable)),_!==void 0&&!Array.isArray(_)&&_.fetchOptions!==void 0&&(N={...N,..._.fetchOptions});let R=u;!Array.isArray(_)&&_?.authToken!==void 0&&(R=_.authToken);let U=typeof j=="function"?j(g,h,{jwtAuth:R!==void 0}):j,Y={"Neon-Connection-String":t,"Neon-Raw-Text-Output":"true","Neon-Array-Mode":"true"},ae=await L2(R);ae&&(Y.Authorization=`Bearer ${ae}`),Array.isArray(S)&&(B!==void 0&&(Y["Neon-Batch-Isolation-Level"]=B),K!==void 0&&(Y["Neon-Batch-Read-Only"]=String(K)),H!==void 0&&(Y["Neon-Batch-Deferrable"]=String(H)));let ve;try{ve=await(E??fetch)(U,{method:"POST",body:JSON.stringify(T),headers:Y,...N})}catch(ge){let Re=new Vi(`Error connecting to database: ${ge.message}`);throw Re.sourceError=ge,Re}if(ve.ok){let ge=await ve.json();if(Array.isArray(S)){let Re=ge.results;if(!Array.isArray(Re))throw new Vi("Neon internal error: unexpected result format");return Re.map((Pe,Le)=>{let vn=_[Le]??{},ra=vn.arrayMode??C,na=vn.fullResults??L;return Nm(Pe,{arrayMode:ra,fullResults:na,parameterizedQuery:S[Le],resultCallback:c,types:vn.types})})}else{let Re=_??{},Pe=Re.arrayMode??C,Le=Re.fullResults??L;return Nm(ge,{arrayMode:Pe,fullResults:Le,parameterizedQuery:S,resultCallback:c,types:Re.types})}}else{let{status:ge}=ve;if(ge===400){let Re=await ve.json(),Pe=new Vi(Re.message);for(let Le of FI)Pe[Le]=Re[Le]??void 0;throw Pe}else{let Re=await ve.text();throw new Vi(`Server error (HTTP status ${ge}): ${Re}`)}}}return b(w,"execute"),y}b(j2,"neon");function R2(t,e,r){return{[Symbol.toStringTag]:"NeonQueryPromise",parameterizedQuery:e,opts:r,then:b((n,i)=>t(e,r).then(n,i),"then"),catch:b(n=>t(e,r).catch(n),"catch"),finally:b(n=>t(e,r).finally(n),"finally")}}b(R2,"createNeonQueryPromise");function Nm(t,{arrayMode:e,fullResults:r,parameterizedQuery:n,resultCallback:i,types:a}){let s=new DI.default(a),o=t.fields.map(l=>l.name),c=t.fields.map(l=>s.getTypeParser(l.dataTypeID)),u=e===!0?t.rows.map(l=>l.map((f,m)=>f===null?null:c[m](f))):t.rows.map(l=>Object.fromEntries(l.map((f,m)=>[o[m],f===null?null:c[m](f)])));return i&&i(n,t,u,{arrayMode:e,fullResults:r}),r?(t.viaNeonFetch=!0,t.rowAsArray=e,t.rows=u,t._parsers=c,t._types=s,t):u}b(Nm,"processQueryResult");async function L2(t){if(typeof t=="string")return t;if(typeof t=="function")try{return await Promise.resolve(t())}catch(e){let r=new Vi("Error getting auth token.");throw e instanceof Error&&(r=new Vi(`Error getting auth token: ${e.message}`)),r}}b(L2,"getAuthToken");var $I=Wi(Mm()),Gi=Wi(Fm()),B2=class extends N2.Client{constructor(e){super(e),this.config=e}get neonConfig(){return this.connection.stream}connect(e){let{neonConfig:r}=root@WOPR:/opt/thedudeabides-store/storefront#                      root@WOPR:/opt/thedudeabides-store/storefront#