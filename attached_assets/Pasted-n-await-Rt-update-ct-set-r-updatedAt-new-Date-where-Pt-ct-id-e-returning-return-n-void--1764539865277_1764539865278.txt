n]=await Rt.update(ct).set({...r,updatedAt:new Date}).where(Pt(ct.id,e)).returning();return n||void 0}async deleteProduct(e){let r=await Rt.delete(ct).where(Pt(ct.id,e));return r.rowCount?r.rowCount>0:!1}async getCartItems(e){return await Rt.select().from(qt).where(Pt(qt.sessionId,e))}async addToCart(e){let[r]=await Rt.insert(qt).values(e).returning();return r}async updateCartItemQuantity(e,r){let[n]=await Rt.update(qt).set({quantity:r}).where(Pt(qt.id,e)).returning();return n||void 0}async removeFromCart(e){let r=await Rt.delete(qt).where(Pt(qt.id,e));return r.rowCount?r.rowCount>0:!1}async clearCart(e){let r=await Rt.delete(qt).where(Pt(qt.sessionId,e));return r.rowCount?r.rowCount>0:!1}},Bt=new Nh;async function m4(t,e){let{insertProductSchema:r,insertCartItemSchema:n}=await Promise.resolve().then(()=>(Zc(),Kc)),{z:i}=await Promise.resolve().then(()=>(Gc(),K2));return e.get("/api/products",async(a,s)=>{try{let o=await Bt.getAllProducts();s.json(o)}catch(o){console.error("Error fetching products:",o),s.status(500).json({message:"Failed to fetch products"})}}),e.get("/api/products/:id",async(a,s)=>{try{let o=parseInt(a.params.id);if(isNaN(o))return s.status(400).json({message:"Invalid product ID"});let c=await Bt.getProductById(o);if(!c)return s.status(404).json({message:"Product not found"});s.json(c)}catch(o){console.error("Error fetching product:",o),s.status(500).json({message:"Failed to fetch product"})}}),e.get("/api/products/category/:category",async(a,s)=>{try{let o=a.params.category,c=await Bt.getProductsByCategory(o);s.json(c)}catch(o){console.error("Error fetching products by category:",o),s.status(500).json({message:"Failed to fetch products"})}}),e.post("/api/products",async(a,s)=>{try{let o=r.parse(a.body),c=await Bt.createProduct(o);s.status(201).json(c)}catch(o){if(o instanceof i.ZodError)return s.status(400).json({message:"Invalid product data",errors:o.errors});console.error("Error creating product:",o),s.status(500).json({message:"Failed to create product"})}}),e.patch("/api/products/:id",async(a,s)=>{try{let o=parseInt(a.params.id);if(isNaN(o))return s.status(400).json({message:"Invalid product ID"});let c=r.partial().parse(a.body),u=await Bt.updateProduct(o,c);if(!u)return s.status(404).json({message:"Product not found"});s.json(u)}catch(o){if(o instanceof i.ZodError)return s.status(400).json({message:"Invalid product data",errors:o.errors});console.error("Error updating product:",o),s.status(500).json({message:"Failed to update product"})}}),e.delete("/api/products/:id",async(a,s)=>{try{let o=parseInt(a.params.id);if(isNaN(o))return s.status(400).json({message:"Invalid product ID"});if(!await Bt.deleteProduct(o))return s.status(404).json({message:"Product not found"});s.status(204).send()}catch(o){console.error("Error deleting product:",o),s.status(500).json({message:"Failed to delete product"})}}),e.get("/api/cart",async(a,s)=>{try{let o=a.session?.id||a.sessionID,c=await Bt.getCartItems(o);s.json(c)}catch(o){console.error("Error fetching cart:",o),s.status(500).json({message:"Failed to fetch cart"})}}),e.post("/api/cart",async(a,s)=>{try{let o=a.session?.id||a.sessionID,c=n.parse({...a.body,sessionId:o}),u=await Bt.addToCart(c);s.status(201).json(u)}catch(o){if(o instanceof i.ZodError)return s.status(400).json({message:"Invalid cart item data",errors:o.errors});console.error("Error adding to cart:",o),s.status(500).json({message:"Failed to add to cart"})}}),e.patch("/api/cart/:id",async(a,s)=>{try{let o=parseInt(a.params.id);if(isNaN(o))return s.status(400).json({message:"Invalid cart item ID"});let{quantity:c}=a.body;if(typeof c!="number"||c<1)return s.status(400).json({message:"Invalid quantity"});let u=await Bt.updateCartItemQuantity(o,c);if(!u)return s.status(404).json({message:"Cart item not found"});s.json(u)}catch(o){console.error("Error updating cart item:",o),s.status(500).json({message:"Failed to update cart item"})}}),e.delete("/api/cart/:id",async(a,s)=>{try{let o=parseInt(a.params.id);if(isNaN(o))return s.status(400).json({message:"Invalid cart item ID"});if(!await Bt.removeFromCart(o))return s.status(404).json({message:"Cart item not found"});s.status(204).send()}catch(o){console.error("Error removing cart item:",o),s.status(500).json({message:"Failed to remove cart item"})}}),e.delete("/api/cart",async(a,s)=>{try{let o=a.session?.id||a.sessionID;await Bt.clearCart(o),s.status(204).send()}catch(o){console.error("Error clearing cart:",o),s.status(500).json({message:"Failed to clear cart"})}}),e.post("/api/admin/seed",async(a,s)=>{try{let o=[{name:"The Dude Cardigan",description:"The classic knit sweater that ties the room together.",price:"89.99",category:"Apparel",image:"https://images.unsplash.com/photo-1434389677669-e08b4cac3105?q=80&w=800&auto=format&fit=crop",vendor:"custom",inStock:!0},{name:"Abide Bowling Pin Tee",description:"Strike! A comfortable tee for league night.",price:"29.99",category:"Apparel",image:"https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?q=80&w=800&auto=format&fit=crop",vendor:"printful",inStock:!0}],c=await Promise.all(o.map(u=>Bt.createProduct(u)));s.status(201).json({message:"Products seeded",count:c.length})}catch(o){console.error("Error seeding products:",o),s.status(500).json({message:"Failed to seed products"})}}),t}var h4=_r(Op(),1),v4=_r(require("fs"),1),Oh=_r(require("path"),1);function g4(t){let e=Oh.default.resolve(__dirname,"public");if(!v4.default.existsSync(e))throw new Error(`Could not find the build directory: ${e}, make sure to build the client first`);t.use(h4.default.static(e)),t.use("*",(r,n)=>{n.sendFile(Oh.default.resolve(e,"index.html"))})}var x4=require("http"),ni=(0,gu.default)(),y4=(0,x4.createServer)(ni);ni.use(gu.default.json({verify:(t,e,r)=>{t.rawBody=r}}));ni.use(gu.default.urlencoded({extended:!1}));function Ih(t,e="express"){let r=new Date().toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",second:"2-digit",hour12:!0});console.log(`${r} [${e}] ${t}`)}ni.use((t,e,r)=>{let n=Date.now(),i=t.path,a,s=e.json;e.json=function(o,...c){return a=o,s.apply(e,[o,...c])},e.on("finish",()=>{let o=Date.now()-n;if(i.startsWith("/api")){let c=`${t.method} ${i} ${e.statusCode} in ${o}ms`;a&&(c+=` :: ${JSON.stringify(a)}`),Ih(c)}}),r()});(async()=>{await m4(y4,ni),ni.use((e,r,n,i)=>{let a=e.status||e.statusCode||500,s=e.message||"Internal Server Error";throw n.status(a).json({message:s}),e}),g4(ni);let t=parseInt(process.env.PORT||"5000",10);y4.listen({port:t,host:"0.0.0.0",reusePort:!0},()=>{Ih(`serving on port ${t}`)})})();0&&(module.exports={log});                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  Error: DATABASE_URL must be set. Did you forget to provision a database?                        at Object.<anonymous> (/opt/Dude_Abides_Store/dist/index.cjs:78:74037)                      at Module._compile (node:internal/modules/cjs/loader:1521:14)                               at Module._extensions..js (node:internal/modules/cjs/loader:1623:10)                        at Module.load (node:internal/modules/cjs/loader:1266:32)                                   at Module._load (node:internal/modules/cjs/loader:1091:12)                                  at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:164:12)      at node:internal/main/run_main_module:28:49                                                                                           Node.js v20.19.5                              root@WOPR:/opt/Dude_Abides_Store# # Press q to exit any pager first, then:                                                                # 1. STOP THE OLD DOCKER STOREFRONT           cd /opt/thedudeabides-store/storefront        docker compose down                                                                         # 2. CREATE THE SYSTEMD SERVICE               sudo tee /etc/systemd/system/dudeabides-frontend.service > /dev/null << 'EOF'               [Unit]                                        Description=The Dude Abides Frontend          After=network.target                                                                        [Service]                                     Type=simple                                   WorkingDirectory=/opt/Dude_Abides_Store       ExecStart=/usr/bin/node dist/index.cjs        Restart=on-failure                            User=www-data                                 Group=www-data                                Environment=NODE_ENV=production               Environment=PORT=3001                         StandardOutput=journal                        StandardError=journal                                                                       [Install]                                     WantedBy=multi-user.target                    EOF                                                                                         # 3. ENABLE THE SERVICE                       sudo systemctl daemon-reload                  sudo systemctl enable dudeabides-frontend                                                   # 4. VERIFY DIRECTORY EXISTS                  sudo mkdir -p /opt/Dude_Abides_Store/dist     sudo chown -R www-data:www-data /opt/Dude_Abides_Store                                                                                    # 5. CHECK STATUS                             docker ps | grep storefront                   systemctl status dudeabides-frontend --no-pager# Press q to exit any pager first, then:     [1]+  Exit 1                  PORT=3001 node dist/index.cjs                                 root@WOPR:/opt/Dude_Abides_Store#             root@WOPR:/opt/Dude_Abides_Store# # 1. STOP THE OLD DOCKER STOREFRONT                       root@WOPR:/opt/Dude_Abides_Store# cd /opt/thedudeabides-store/storefront                    root@WOPR:/opt/thedudeabides-store/storefront# docker compose down                          WARN[0000] /opt/thedudeabides-store/storefront/docker-compose.yml: `version` is obsolete    root@WOPR:/opt/thedudeabides-store/storefront#                                              root@WOPR:/opt/thedudeabides-store/storefront# # 2. CREATE THE SYSTEMD SERVICE              root@WOPR:/opt/thedudeabides-store/storefront# sudo tee /etc/systemd/system/dudeabides-frontend.service > /dev/null << 'EOF'              > [Unit]                                      > Description=The Dude Abides Frontend        > After=network.target                        >                                             > [Service]                                   > Type=simple                                 > WorkingDirectory=/opt/Dude_Abides_Store     > ExecStart=/usr/bin/node dist/index.cjs      > Restart=on-failure                          > User=www-data                               > Group=www-data                              > Environment=NODE_ENV=production             > Environment=PORT=3001                       > StandardOutput=journal                      > StandardError=journal                       >                                             > [Install]                                   > WantedBy=multi-user.target                  > EOF                                         root@WOPR:/opt/thedudeabides-store/storefront#                                              root@WOPR:/opt/thedudeabides-store/storefront# # 3. ENABLE THE SERVICE                      root@WOPR:/opt/thedudeabides-store/storefront# sudo systemctl daemon-reload                 sudo systemctl enable dudeabides-frontend                                                   # 4. VERIFY DIRECTORY EXISTS                  sudo mkdir -p /opt/Dude_Abides_Store/dist     sudo chown -R www-data:www-data /opt/Dude_Abides_Store                                                                                    # 5. CHECK STATUS                             docker ps | grep storefront                   systemctl status dudeabides-frontend --no-pagerroot@WOPR:/opt/thedudeabides-store/storefront#                                             root@WOPR:/opt/thedudeabides-store/storefront#                                              root@WOPR:/opt/thedudeabides-store/storefront#