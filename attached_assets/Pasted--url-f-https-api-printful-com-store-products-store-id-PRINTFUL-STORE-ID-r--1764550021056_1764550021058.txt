
    url = f"https://api.printful.com/store/products?store_id={PRINTFUL_STORE_ID}"               r = requests.get(url, headers={"Authorization": f"Bearer {PRINTFUL_API_KEY}"}, timeout=30)                                                r.raise_for_status()                          products = r.json().get("result", [])                                                       results = []                                  for p in products:                                template_id = p.get("id")                     try:                                              result = import_printful_product(template_id)                                               results.append({"id": template_id, "status": "ok", "result": result})                   except Exception as e:                            logger.error(f"Failed to import {template_id}: {e}")
            results.append({"id": template_id, "status": "error", "error": str(e)})
                                                  return {"synced": len(results), "results": results}
root@WOPR:/opt/thedudeabides-store/storefront# curl -X POST https://dudeabides.wopr.systems/graphql/ \
>   -H 'Content-Type: application/json' \     >   -d '{"query":"{ channels { id slug name } }"}'
{"errors": [{"message": "To access this path, you need one of the following permissions: AUTHENTICATED_APP, AUTHENTICATED_STAFF_USER", "locations": [{"line": 1, "column": 3}], "path": ["channels"], "extensions": {"exception": {"code": "PermissionDenied", "stacktrace": ["Traceback (most recent call last):", "  File \"/usr/local/lib/python3.12/site-packages/graphql/execution/executor.py\", line 452, in resolve_or_error", "    return executor.execute(resolve_fn, source, info, **args)", "           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^", "  File \"/usr/local/lib/python3.12/site-packages/graphql/execution/executors/sync.py\", line 16, in execute", "    return fn(*args, **kwargs)", "           ^^^^^^^^^^^^^^^^^^^", "  File \"/app/saleor/graphql/decorators.py\", line 31, in wrapper", "    return func(info.context, *args, **kwargs)", "           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^", "  File \"/app/saleor/graphql/decorators.py\", line 45, in wrapper", "    test_func(context)", "  File \"/app/saleor/graphql/decorators.py\", line 86, in check_perms", "    raise PermissionDenied(permissions=perms)", "saleor.core.exceptions.PermissionDenied: To access this path, you need one of the following permissions: AUTHENTICATED_APP, AUTHENTICATED_STAFF_USER"]}}}], "data": {"channels": null}, "extensions": {"cost": {"requestedQueryCost": 1, "maximumAvailable": 50000}}}root@WOPR:/opt/thedudeabides-store/storefront#                                              root@WOPR:/opt/thedudeabides-store/storefront#     r = requests.get(url, headers={"Authorization": f"Bearer {PRINTFUL_API_KEY}"}, timeout=15)                                                r.raise_for_status()                          data = r.json()["result"]                                                                   product = data["sync_product"]                variants = data["sync_variants"]              orig_slug = f"printful-{template_id}"                                                       desc_full, seo_text = build_description(product.get("description") or product.get("name"))                                                                                              create_query = """                           mutation CreateProduct($input: ProductCreateInput!) {                                         productCreate(input: $input) {                  product { id name slug }                      errors { field message }                    }                                           }                                             """                                                                                         create_res = saleor_graphql(                      create_query,                                 {                                                 "input": {                                        "name": product["name"],                      "slug": orig_slug,                            "seo": {"title": product["name"], "description": seo_text},                                 "productType": "UHJvZHVjdFR5cGU6MQ==",                                                      "category": "Q2F0ZWdvcnk6MQ==",                                             root@WOPR:/opt/thedudeabides-store/storefront#-bash: syntax error near unexpected token `(' -bash: !: event not found                     -bash: syntax error near unexpected token `}' -bash: syntax error near unexpected token `(' publish_query,: command not found             isPublished:: command not found               },: command not found                         -bash: syntax error near unexpected token `)' -bash: syntax error near unexpected token `(' quantity:: command not found                  -bash: syntax error near unexpected token `}' -bash: syntax error near unexpected token `)' -bash: !,: event not found                    -bash: syntax error near unexpected token `)' -bash: syntax error near unexpected token `}' -bash: syntax error near unexpected token `(' root@WOPR:/opt/thedudeabides-store/storefront#                                              root@WOPR:/opt/thedudeabides-store/storefront# curl -X POST https://dudeabides.wopr.systems/graphql/ \                                    >   -H 'Content-Type: application/json' \     >   -H 'Authorization: Bearer lethwrqrb5ur5MPtLwzemb68OgSPGX' \                             >   -d '{"query":"{ channels { id slug name } }"}'                                          {"data": {"channels": [{"id": "Q2hhbm5lbDox", "slug": "default-channel", "name": "Default Channel"}, {"id": "Q2hhbm5lbDoy", "slug": "the-dude-abides-shop", "name": "The Dude Abides Shop"}]}, "extensions": {"cost": {"requestedQueryCost": 1, "maximumAvailable": 50000}}}root@WOPR:/opt/thedudeabides-store/storefront#        root@WOPR:/opt/thedudeabides-store/storefront# # Check how printful-sync is running         root@WOPR:/opt/thedudeabides-store/storefront# docker ps | grep printful                    ffb358bcfaff   printful-sync-printful-sync               "uvicorn app:app --hâ€¦"   23 hours ago     Up 11 hours             0.0.0.0:8055->8055/tcp                           printful-sync-printful-sync-1                             root@WOPR:/opt/thedudeabides-store/storefront#                                              root@WOPR:/opt/thedudeabides-store/storefront# # If it's docker-compose, restart and re-syncroot@WOPR:/opt/thedudeabides-store/storefront# cd /opt/printful-sync && docker-compose up -d                                              Building printful-sync                        [+] Building 1.6s (10/10) FINISHED docker:defa => [internal] load build definition fr  0.1s  => => transferring dockerfile: 284B     0.0s  => [internal] load metadata for docker  1.1s  => [internal] load .dockerignore        0.0s  => => transferring context: 2B          0.0s  => [1/5] FROM docker.io/library/python  0.0s  => [internal] load build context        0.0s  => => transferring context: 22.91kB     0.0s  => CACHED [2/5] WORKDIR /app            0.0s  => CACHED [3/5] COPY requirements.txt   0.0s  => CACHED [4/5] RUN pip install --no-c  0.0s  => [5/5] COPY . .                       0.1s  => exporting to image                   0.1s  => => exporting layers                  0.0s  => => writing image sha256:31aef9a7c40  0.0s  => => naming to docker.io/library/prin  0.0s WARNING: Image for service printful-sync was built because it did not already exist. To rebuild this image you must use `docker-compose build` or `docker-compose up --build`.          Recreating printful-sync-printful-sync-1 ...                                                ERROR: for printful-sync-printful-sync-1  'ContainerConfig'                                                                               ERROR: for printful-sync  'ContainerConfig'                                                 ^CTraceback (most recent call last):            File "/usr/bin/docker-compose", line 33, in <module>                                          sys.exit(load_entry_point('docker-compose==1.29.2', 'console_scripts', 'docker-compose')())                                                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^                                              File "/usr/lib/python3/dist-packages/compose/cli/main.py", line 81, in main                   command_func()                              File "/usr/lib/python3/dist-packages/compose/cli/main.py", line 203, in perform_command       handler(command, command_options)           File "/usr/lib/python3/dist-packages/compose/metrics/decorator.py", line 18, in wrapper       result = fn(*args, **kwargs)                           ^^^^^^^^^^^^^^^^^^^                File "/usr/lib/python3/dist-packages/compose/cli/main.py", line 1186, in up                   to_attach = up(False)                                     ^^^^^^^^^                       File "/usr/lib/python3/dist-packages/compose/cli/main.py", line 1166, in up                   return self.project.up(                              ^^^^^^^^^^^^^^^^                     File "/usr/lib/python3/dist-packages/compose/project.py", line 697, in up                     results, errors = parallel.parallel_execute(                                                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^                                              File "/usr/lib/python3/dist-packages/compose/parallel.py", line 108, in parallel_execute      raise error_to_reraise                      File "/usr/lib/python3/dist-packages/compose/parallel.py", line 206, in producer              result = func(obj)                                     ^^^^^^^^^                          File "/usr/lib/python3/dist-packages/compose/project.py", line 679, in do                     return service.execute_convergence_plan(             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^    File "/usr/lib/python3/dist-packages/compose/service.py", line 579, in execute_convergence_plan                                             return self._execute_convergence_recreate(           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^  File "/usr/lib/python3/dist-packages/compose/service.py", line 499, in _execute_convergence_recreate                                        containers, errors = parallel_execute(                             ^^^^^^^^^^^^^^^^^      File "/usr/lib/python3/dist-packages/compose/parallel.py", line 108, in parallel_execute      raise error_to_reraise                      File "/usr/lib/python3/dist-packages/compose/parallel.py", line 206, in producer              result = func(obj)                                     ^^^^^^^^^                          File "/usr/lib/python3/dist-packages/compose/service.py", line 494, in recreate               return self.recreate_container(                      ^^^^^^^^^^^^^^^^^^^^^^^^             File "/usr/lib/python3/dist-packages/compose/service.py", line 612, in recreate_container     new_container = self.create_container(                        ^^^^^^^^^^^^^^^^^^^^^^      File "/usr/lib/python3/dist-packages/compose/service.py", line 330, in create_container       container_options = self._get_container_create_options(                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^                                   File "/usr/lib/python3/dist-packages/compose/service.py", line 921, in _get_container_create_options                                        container_options, override_options = self._build_container_volume_options(                                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^               File "/usr/lib/python3/dist-packages/compose/service.py", line 960, in _build_container_volume_options                                      binds, affinity = merge_volume_bindings(                        ^^^^^^^^^^^^^^^^^^^^^^    File "/usr/lib/python3/dist-packages/compose/service.py", line 1548, in merge_volume_bindings                                               old_volumes, old_mounts = get_container_data_volumes(                                                                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^                                     File "/usr/lib/python3/dist-packages/compose/service.py", line 1579, in get_container_data_volumes                                          container.image_config['ContainerConfig'].get('Volumes') or {}                              ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^ KeyError: 'ContainerConfig'                   Error in sys.excepthook:                      Traceback (most recent call last):              File "/usr/lib/python3/dist-packages/apport_python_hook.py", line 228, in partial_apport_excepthook                                         return apport_excepthook(binary, exc_type, exc_obj, exc_tb)                                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^                               File "/usr/lib/python3/dist-packages/apport_python_hook.py", line 123, in apport_excepthook                                                 report.add_package_info()                   File "/usr/lib/python3/dist-packages/apport/report.py", line 460, in add_package_info         self["Dependencies"] = self._get_transitive_dependencies(package)                                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^                         File "/usr/lib/python3/dist-packages/apport/report.py", line 414, in _get_transitive_dependencies                                           v = packaging.get_version(dep)                    ^^^^^^^^^^^^^^^^^^^^^^^^^^              File "/usr/lib/python3/dist-packages/apport/packaging_impl/apt_dpkg.py", line 281, in get_version                                           pkg = self._apt_pkg(package)                        ^^^^^^^^^^^^^^^^^^^^^^                File "/usr/lib/python3/dist-packages/apport/packaging_impl/apt_dpkg.py", line 275, in _apt_pkg                                              return self._cache()[package]                        ^^^^^^^^^^^^^                        File "/usr/lib/python3/dist-packages/apport/packaging_impl/apt_dpkg.py", line 229, in _cache                                                if not self._apt_cache:                              ^^^^^^^^^^^^^^^                      File "/usr/lib/python3/dist-packages/apt/cache.py", line 332, in __len__                      return len(self.keys())                                  ^^^^^^^^^^^                      File "/usr/lib/python3/dist-packages/apt/cache.py", line 341, in keys                         return list(self._sorted_set)  # We need a copy here, caller may modify                            ^^^^^^^^^^^^^^^^^^^^^^             KeyboardInterrupt                                                                           Original exception was:                       Traceback (most recent call last):              File "/usr/bin/docker-compose", line 33, in <module>                                          sys.exit(load_entry_point('docker-compose==1.29.2', 'console_scripts', 'docker-compose')())                                                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^                                              File "/usr/lib/python3/dist-packages/compose/cli/main.py", line 81, in main                   command_func()                              File "/usr/lib/python3/dist-packages/compose/cli/main.py", line 203, in perform_command       handler(command, command_options)           File "/usr/lib/python3/dist-packages/compose/metrics/decorator.py", line 18, in wrapper       result = fn(*args, **kwargs)                           ^^^^^^^^^^^^^^^^^^^                File "/usr/lib/python3/dist-packages/compose/cli/main.py", line 1186, in up                   to_attach = up(False)                                     ^^^^^^^^^                       File "/usr/lib/python3/dist-packages/compose/cli/main.py", line 1166, in up                   return self.project.up(                              ^^^^^^^^^^^^^^^^                     File "/usr/lib/python3/dist-packages/compose/project.py", line 697, in up                     results, errors = parallel.parallel_execute(                                                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^                                              File "/usr/lib/python3/dist-packages/compose/parallel.py", line 108, in parallel_execute      raise error_to_reraise                      File "/usr/lib/python3/dist-packages/compose/parallel.py", line 206, in producer              result = func(obj)                                     ^^^^^^^^^                          File "/usr/lib/python3/dist-packages/compose/project.py", line 679, in do                     return service.execute_convergence_plan(             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^    File "/usr/lib/python3/dist-packages/compose/service.py", line 579, in execute_convergence_plan                                             return self._execute_convergence_recreate(           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^  File "/usr/lib/python3/dist-packages/compose/service.py", line 499, in _execute_convergence_recreate                                        containers, errors = parallel_execute(                             ^^^^^^^^^^^^^^^^^      File "/usr/lib/python3/dist-packages/compose/parallel.py", line 108, in parallel_execute      raise error_to_reraise                      File "/usr/lib/python3/dist-packages/compose/parallel.py", line 206, in producer              result = func(obj)                                     ^^^^^^^^^                          File "/usr/lib/python3/dist-packages/compose/service.py", line 494, in recreate               return self.recreate_container(                      ^^^^^^^^^^^^^^^^^^^^^^^^             File "/usr/lib/python3/dist-packages/compose/service.py", line 612, in recreate_container     new_container = self.create_container(                        ^^^^^^^^^^^^^^^^^^^^^^      File "/usr/lib/python3/dist-packages/compose/service.py", line 330, in create_container       container_options = self._get_container_create_options(                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^                                   File "/usr/lib/python3/dist-packages/compose/service.py", line 921, in _get_container_create_options                                        container_options, override_options = self._build_container_volume_options(                                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^               File "/usr/lib/python3/dist-packages/compose/service.py", line 960, in _build_container_volume_options                                      binds, affinity = merge_volume_bindings(                        ^^^^^^^^^^^^^^^^^^^^^^    File "/usr/lib/python3/dist-packages/compose/service.py", line 1548, in merge_volume_bindings                                               old_volumes, old_mounts = get_container_data_volumes(                                                                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^                                     File "/usr/lib/python3/dist-packages/compose/service.py", line 1579, in get_container_data_volumes                                          container.image_config['ContainerConfig'].get('Volumes') or {}                              ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^ KeyError: 'ContainerConfig'                   root@WOPR:/opt/printful-sync#