ap(l=>s.getTypeParser(l.dataTypeID)),u=e===!0?t.rows.map(l=>l.map((f,m)=>f===null?null:c[m](f))):t.rows.map(l=>Object.fromEntries(l.map((f,m)=>[o[m],f===null?null:c[m](f)])));return i&&i(n,t,u,{arrayMode:e,fullResults:r}),r?(t.viaNeonFetch=!0,t.rowAsArray=e,t.rows=u,t._parsers=c,t._types=s,t):u}b(Nm,"processQueryResult");async function L2(t){if(typeof t=="string")return t;if(typeof t=="function")try{return await Promise.resolve(t())}catch(e){let r=new Vi("Error getting auth token.");throw e instanceof Error&&(r=new Vi(`Error getting auth token: ${e.message}`)),r}}b(L2,"getAuthToken");var $I=Wi(Mm()),Gi=Wi(Fm()),B2=class extends N2.Client{constructor(e){super(e),this.config=e}get neonConfig(){return this.connection.stream}connect(e){let{neonConfig:r}=this;r.forceDisablePgSSL&&(this.ssl=this.connection.ssl=!1),this.ssl&&r.useSecureWebSocket&&console.warn("SSL is enabled for both Postgres (e.g. ?sslmode=require in the connection string + forceDisablePgSSL = false) and the WebSocket tunnel (useSecureWebSocket = true). Double encryption will increase latency and CPU usage. It may be appropriate to disable SSL in the Postgres connection parameters or set forceDisablePgSSL = true.");let n=this.config?.host!==void 0||this.config?.connectionString!==void 0||le.env.PGHOST!==void 0,i=le.env.USER??le.env.USERNAME;if(!n&&this.host==="localhost"&&this.user===i&&this.database===i&&this.password===null)throw new Error(`No database host or connection string was set, and key parameters have default values (host: localhost, user: ${i}, db: ${i}, password: null). Is an environment variable missing? Alternatively, if you intended to connect with these parameters, please set the host to 'localhost' explicitly.`);let a=super.connect(e),s=r.pipelineTLS&&this.ssl,o=r.pipelineConnect==="password";if(!s&&!r.pipelineConnect)return a;let c=this.connection;if(s&&c.on("connect",()=>c.stream.emit("data","S")),o){c.removeAllListeners("authenticationCleartextPassword"),c.removeAllListeners("readyForQuery"),c.once("readyForQuery",()=>c.on("readyForQuery",this._handleReadyForQuery.bind(this)));let u=this.ssl?"sslconnect":"connect";c.on(u,()=>{this._handleAuthCleartextPassword(),this._handleReadyForQuery()})}return a}async _handleAuthSASLContinue(e){let r=this.saslSession,n=this.password,i=e.data;if(r.message!=="SASLInitialResponse"||typeof n!="string"||typeof i!="string")throw new Error("SASL: protocol error");let a=Object.fromEntries(i.split(",").map(ae=>{if(!/^.=/.test(ae))throw new Error("SASL: Invalid attribute pair entry");let ve=ae[0],ge=ae.substring(2);return[ve,ge]})),s=a.r,o=a.s,c=a.i;if(!s||!/^[!-+--~]+$/.test(s))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce missing/unprintable");if(!o||!/^(?:[a-zA-Z0-9+/]{4})*(?:[a-zA-Z0-9+/]{2}==|[a-zA-Z0-9+/]{3}=)?$/.test(o))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt missing/not base64");if(!c||!/^[1-9][0-9]*$/.test(c))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: missing/invalid iteration count");if(!s.startsWith(r.clientNonce))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce does not start with client nonce");if(s.length===r.clientNonce.length)throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce is too short");let u=parseInt(c,10),l=se.from(o,"base64"),f=new TextEncoder,m=f.encode(n),g=await ot.subtle.importKey("raw",m,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),h=new Uint8Array(await ot.subtle.sign("HMAC",g,se.concat([l,se.from([0,0,0,1])]))),d=h;for(var y=0;y<u-1;y++)h=new Uint8Array(await ot.subtle.sign("HMAC",g,h)),d=se.from(d.map((ae,ve)=>d[ve]^h[ve]));let w=d,S=await ot.subtle.importKey("raw",w,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),_=new Uint8Array(await ot.subtle.sign("HMAC",S,f.encode("Client Key"))),I=await ot.subtle.digest("SHA-256",_),j="n=*,r="+r.clientNonce,E="r="+s+",s="+o+",i="+u,T="c=biws,r="+s,N=j+","+E+","+T,C=await ot.subtle.importKey("raw",I,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]);var L=new Uint8Array(await ot.subtle.sign("HMAC",C,f.encode(N))),B=se.from(_.map((ae,ve)=>_[ve]^L[ve])),K=B.toString("base64");let H=await ot.subtle.importKey("raw",w,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),R=await ot.subtle.sign("HMAC",H,f.encode("Server Key")),U=await ot.subtle.importKey("raw",R,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]);var Y=se.from(await ot.subtle.sign("HMAC",U,f.encode(N)));r.message="SASLResponse",r.serverSignature=Y.toString("base64"),r.response=T+",p="+K,this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}};b(B2,"NeonClient");var UI=B2;function M2(t,e){if(e)return{callback:e,result:void 0};let r,n,i=b(function(s,o){s?r(s):n(o)},"cb"),a=new t(function(s,o){n=s,r=o});return{callback:i,result:a}}b(M2,"promisify");var D2=class extends N2.Pool{constructor(){super(...arguments),oe(this,"Client",UI),oe(this,"hasFetchUnsupportedListeners",!1)}on(e,r){return e!=="error"&&(this.hasFetchUnsupportedListeners=!0),super.on(e,r)}query(e,r,n){if(!fn.poolQueryViaFetch||this.hasFetchUnsupportedListeners||typeof e=="function")return super.query(e,r,n);typeof r=="function"&&(n=r,r=void 0);let i=M2(this.Promise,n);n=i.callback;try{let a=new $I.default(this.options),s=encodeURIComponent,o=encodeURI,c=`postgresql://${s(a.user)}:${s(a.password)}@${s(a.host)}/${o(a.database)}`,u=typeof e=="string"?e:e.text,l=r??e.values??[];j2(c,{fullResults:!0,arrayMode:e.rowMode==="array"})(u,l,{types:e.types??this.options?.types}).then(f=>n(void 0,f)).catch(f=>n(f))}catch(a){n(a)}return i.result}};b(D2,"NeonPool");var Or=D2,sV=Gi.ClientBase,oV=Gi.Connection,cV=Gi.DatabaseError,uV=Gi.Query,lV=Gi.defaults,Xt=Gi.types;V();Bc();kc();hc();ns();Se();V();Bc();lm();um();Ge();Se();var $m=class extends Ac{constructor(e,r,n,i,a,s,o,c){super({sql:r,params:n}),this.client=e,this.params=n,this.logger=i,this.fields=a,this._isResponseInArrayMode=o,this.customResultMapper=c,this.rawQueryConfig={name:s,text:r,types:{getTypeParser:(u,l)=>u===Xt.builtins.TIMESTAMPTZ?f=>f:u===Xt.builtins.TIMESTAMP?f=>f:u===Xt.builtins.DATE?f=>f:u===Xt.builtins.INTERVAL?f=>f:Xt.getTypeParser(u,l)}},this.queryConfig={name:s,text:r,rowMode:"array",types:{getTypeParser:(u,l)=>u===Xt.builtins.TIMESTAMPTZ?f=>f:u===Xt.builtins.TIMESTAMP?f=>f:u===Xt.builtins.DATE?f=>f:u===Xt.builtins.INTERVAL?f=>f:Xt.getTypeParser(u,l)}}}static[k]="NeonPreparedQuery";rawQueryConfig;queryConfig;async execute(e={}){let r=ec(this.params,e);this.logger.logQuery(this.rawQueryConfig.text,r);let{fields:n,client:i,rawQueryConfig:a,queryConfig:s,joinsNotNullableMap:o,customResultMapper:c}=this;if(!n&&!c)return i.query(a,r);let u=await i.query(s,r);return c?c(u.rows):u.rows.map(l=>pw(n,l,o))}all(e={}){let r=ec(this.params,e);return this.logger.logQuery(this.rawQueryConfig.text,r),this.client.query(this.rawQueryConfig,r).then(n=>n.rows)}values(e={}){let r=ec(this.params,e);return this.logger.logQuery(this.rawQueryConfig.text,r),this.client.query(this.queryConfig,r).then(n=>n.rows)}isResponseInArrayMode(){return this._isResponseInArrayMode}},Vc=class t extends Pc{constructor(e,r,n,i={}){super(r),this.client=e,this.schema=n,this.options=i,this.logger=i.logger??new Lc}static[k]="NeonSession";logger;prepareQuery(e,r,n,i,a){return new $m(this.client,e.sql,e.params,this.logger,r,n,i,a)}async query(e,r){return this.logger.logQuery(e,r),await this.client.query({rowMode:"array",text:e,values:r})}async queryObjects(e,r){return this.client.query(e,r)}async count(e){let r=await this.execute(e);return Number(r.rows[0].count)}async transaction(e,r={}){let n=this.client instanceof Or?new t(await this.client.connect(),this.dialect,this.schema,this.options):this,i=new Um(this.dialect,n,this.schema);await i.execute(A`begin ${i.getTransactionConfigSQL(r)}`);try{let a=await e(i);return await i.execute(A`commit`),a}catch(a){throw await i.execute(A`rollback`),a}finally{this.client instanceof Or&&n.client.release()}}},Um=class t extends Nc{static[k]="NeonTransaction";async transaction(e){let r=`sp${this.nestedIndex+1}`,n=new t(this.dialect,this.session,this.schema,this.nestedIndex+1);await n.execute(A.raw(`savepoint ${r}`));try{let i=await e(n);return await n.execute(A.raw(`release savepoint ${r}`)),i}catch(i){throw await n.execute(A.raw(`rollback to savepoint ${r}`)),i}}};var zm=class{constructor(e,r,n={}){this.client=e,this.dialect=r,this.options=n}static[k]="NeonDriver";createSession(e){return new Vc(this.client,this.dialect,e,{logger:this.options.logger})}},Qm=class extends Fi{static[k]="NeonServerlessDatabase"};function ys(t,e={}){let r=new Kr({casing:e.casing}),n;e.logger===!0?n=new Rc:e.logger!==!1&&(n=e.logger);let i;if(e.schema){let c=b_(e.schema,__);i={fullSchema:e.schema,schema:c.tables,tableNamesMap:c.tableNamesMap}}let s=new zm(t,r,{logger:n}).createSession(i),o=new Qm(r,s,i);return o.$client=t,o}function Hc(...t){if(typeof t[0]=="string"){let e=new Or({connectionString:t[0]});return ys(e,t[1])}if(mw(t[0])){let{connection:e,client:r,ws:n,...i}=t[0];if(n&&(fn.webSocketConstructor=n),r)return ys(r,i);let a=typeof e=="string"?new Or({connectionString:e}):new Or(e);return ys(a,i)}return ys(t[0],t[1])}(t=>{function e(r){return ys({},r)}t.mock=e})(Hc||(Hc={}));var hq=vr(e4(),1),vq=vr(uh(),1),gq=vr(dh(),1),l4=vr(iu(),1),yq=vr(u4(),1);var p4=l4.default;Dc();fn.webSocketConstructor=p4;if(!process.env.DATABASE_URL)throw new Error("DATABASE_URL must be set. Did you forget to provision a database?");var xq=new Or({connectionString:process.env.DATABASE_URL}),Pt=Hc({client:xq,schema:Mc});_m();var bh=class{async getAllProducts(){return await Pt.select().from(it)}async getProductById(e){let[r]=await Pt.select().from(it).where(wt(it.id,e));return r||void 0}async getProductsByCategory(e){return await Pt.select().from(it).where(wt(it.category,e))}async getProductsByVendor(e){return await Pt.select().from(it).where(wt(it.vendor,e))}async createProduct(e){let[r]=await Pt.insert(it).values(e).returning();return r}async updateProduct(e,r){let[n]=await Pt.update(it).set({...r,updatedAt:new Date}).where(wt(it.id,e)).returning();return n||void 0}async deleteProduct(e){let r=await Pt.delete(it).where(wt(it.id,e));return r.rowCount?r.rowCount>0:!1}async getCartItems(e){return await Pt.select().from(Tt).where(wt(Tt.sessionId,e))}async addToCart(e){let[r]=await Pt.insert(Tt).values(e).returning();return r}async updateCartItemQuantity(e,r){let[n]=await Pt.update(Tt).set({quantity:r}).where(wt(Tt.id,e)).returning();return n||void 0}async removeFromCart(e){let r=await Pt.delete(Tt).where(wt(Tt.id,e));return r.rowCount?r.rowCount>0:!1}async clearCart(e){let r=await Pt.delete(Tt).where(wt(Tt.sessionId,e));return r.rowCount?r.rowCount>0:!1}},Nt=new bh;var bq=process.env.SALEOR_API_URL||"https://dudeabides.wopr.systems/graphql/",d4=process.env.SALEOR_MEDIA_URL||"https://dudeabides.wopr.systems",su=process.env.SALEOR_CHANNEL||"the-dude-abides-shop";function Yn(t){if(!t)return t;if(typeof t=="string")return t.replace(/http:\/\/localhost:8000/g,d4).replace(/http:\/\/saleor-api-dude:8000/g,d4);if(Array.isArray(t))return t.map(e=>Yn(e));if(typeof t=="object"){let e={};for(let r of Object.keys(t))e[r]=Yn(t[r]);return e}return t}var wq=`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             Error: DATABASE_URL must be set. Did you forget to provision a database?                        at Object.<anonymous> (/opt/thedudeabides-store/storefront/dist/index.cjs:76:74037)         at Module._compile (node:internal/modules/cjs/loader:1706:14)                               at Object..js (node:internal/modules/cjs/loader:1839:10)                                    at Module.load (node:internal/modules/cjs/loader:1441:32)                                   at Function._load (node:internal/modules/cjs/loader:1263:12)                                at TracingChannel.traceSync (node:diagnostics_channel:328:14)                               at wrapModuleLoad (node:internal/modules/cjs/loader:237:24)                                 at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:171:5)       at node:internal/main/run_main_module:36:49                                                                                           root@WOPR:/opt/thedudeabides-store/storefront# curl -I http://127.0.0.1:3001 | head -3        % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current                                              Dload  Upload   Total   Spent    Left  Speed                 0     0    0     0    0     0      0      0   0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0              curl: (7) Failed to connect to 127.0.0.1 port 3001 after 3 ms: Couldn't connect to server   [1]+  Exit 1                  PORT=3001 node dist/index.cjs                                 root@WOPR:/opt/thedudeabides-store/storefront# curl -I http://127.0.0.1:3001 | head -3        % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current                                              Dload  Upload   Total   Spent    Left  Speed                 0     0    0     0    0     0      0      0   0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0              curl: (7) Failed to connect to 127.0.0.1 port 3001 after 1 ms: Couldn't connect to server   root@WOPR:/opt/thedudeabides-store/storefront#