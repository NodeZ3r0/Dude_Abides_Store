 sleep 5                                      root@WOPR:/opt/thedudeabides-store/storefront# curl -I http://127.0.0.1:3001/               curl: (7) Failed to connect to 127.0.0.1 port 3001 after 0 ms: Couldn't connect to server   root@WOPR:/opt/thedudeabides-store/storefront# # Create .env file with the required variables                                             root@WOPR:/opt/thedudeabides-store/storefront# cat > /opt/thedudeabides-store/storefront/.env << 'EOF'                                    > NEXT_PUBLIC_SALEOR_API_URL=https://dudeabides.wopr.systems/graphql/
> NEXT_PUBLIC_STOREFRONT_URL=https://dudeabides.wopr.systems
> EOF                                         root@WOPR:/opt/thedudeabides-store/storefront#                                              root@WOPR:/opt/thedudeabides-store/storefront# # Also note: the docker-compose uses port 3000, but Caddy expects 3001                     root@WOPR:/opt/thedudeabides-store/storefront# # Let's fix the docker-compose to use 3001
root@WOPR:/opt/thedudeabides-store/storefront# sed -i 's/- 3000:3000/- 3001:3000/' /opt/thedudeabides-store/storefront/docker-compose.yml root@WOPR:/opt/thedudeabides-store/storefront#                                              root@WOPR:/opt/thedudeabides-store/storefront# # Verify the changes                         root@WOPR:/opt/thedudeabides-store/storefront# cat /opt/thedudeabides-store/storefront/.env NEXT_PUBLIC_SALEOR_API_URL=https://dudeabides.wopr.systems/graphql/                         NEXT_PUBLIC_STOREFRONT_URL=https://dudeabides.wopr.systems
root@WOPR:/opt/thedudeabides-store/storefront# cat /opt/thedudeabides-store/storefront/docker-compose.yml                                 version: "3"

services:                                       saleor-storefront:                              container_name: saleor-storefront             build:                                          dockerfile: Dockerfile                        args:                                           NEXT_PUBLIC_SALEOR_API_URL: ${NEXT_PUBLIC_SALEOR_API_URL}                                   NEXT_PUBLIC_STOREFRONT_URL: ${NEXT_PUBLIC_STOREFRONT_URL}                               restart: always                               ports:                                          - 3001:3000                                 networks:                                       - saleor_network                                                                        # Add more containers below (nginx, postgres, etc.)                                                                                     networks:                                       saleor_network:                                 external: false                           root@WOPR:/opt/thedudeabides-store/storefront#                                              root@WOPR:/opt/thedudeabides-store/storefront# # Now rebuild and start                      root@WOPR:/opt/thedudeabides-store/storefront# cd /opt/thedudeabides-store/storefront
root@WOPR:/opt/thedudeabides-store/storefront# docker compose up -d --build                 WARN[0000] /opt/thedudeabides-store/storefront/docker-compose.yml: `version` is obsolete    [+] Building 567.1s (24/24) FINISHED docker:defaultACHED [saleor-storefront deps 3/5]  0.0s  => [saleor-storefront internal] load b  0.0s  => => transferring dockerfile: 1.30kB   0.0s  => [saleor-storefront internal] load m  1.2s  => [saleor-storefront internal] load .  0.0s  => => transferring context: 113B        0.0s  => [saleor-storefront internal] load b  0.4s  => => transferring context: 26.88kB     0.3s  => [saleor-storefront base 1/1] FROM d  0.0s  => CACHED [saleor-storefront builder 1  0.0s  => [saleor-storefront runner 2/8] RUN   1.0s
 => CACHED [saleor-storefront deps 1/5]  0.0s  => CACHED [saleor-storefront deps 2/5]  0.0s  => CACHED [saleor-storefront deps 3/5]  0.0s
 => CACHED [saleor-storefront deps 4/5]  0.0s  => CACHED [saleor-storefront deps 5/5]  0.0s  => CACHED [saleor-storefront builder 2  0.0s  => [saleor-storefront builder 3/6] COP  0.9s  => [saleor-storefront runner 3/8] RUN   1.2s
 => [saleor-storefront builder 4/6] COP  1.1s
 => [saleor-storefront builder 5/6] RUN  1.6s  => [saleor-storefront builder 6/6] R  541.9s  => [saleor-storefront runner 4/8] COPY  0.5s  => [saleor-storefront runner 5/8] RUN   0.9s  => [saleor-storefront runner 6/8] RUN   0.8s
 => [saleor-storefront runner 7/8] COPY  2.1s  => [saleor-storefront runner 8/8] COPY  0.2s  => [saleor-storefront] exporting to im  1.4s  => => exporting layers                  1.4s  => => writing image sha256:ea7f41c8d7f  0.0s  => => naming to docker.io/library/stor  0.0s [+] Running 0/0                               [+] Running 0/1efront_saleor_network  Creating[+] Running 0/1efront_saleor_network  Creating[+] Running 1/1efront_saleor_network  Creating ✔ Network storefront_saleor_network  Created0[+] Running 1/2                                ✔ Network storefront_saleor_network  Created0[+] Running 1/2                                ✔ Network storefront_saleor_network  Created0[+] Running 1/2
 ✔ Network storefront_saleor_network  Created0[+] Running 1/2                                ✔ Network storefront_saleor_network  Created0[+] Running 1/2                                ✔ Network storefront_saleor_network  Created0[+] Running 1/2                                ✔ Network storefront_saleor_network  Created0[+] Running 2/2                                ✔ Network storefront_saleor_network  Created0.2s                                            ✔ Container saleor-storefront        Started0.8s                                           root@WOPR:/opt/thedudeabides-store/storefront#                                              root@WOPR:/opt/thedudeabides-store/storefront# # Check if it's running                      root@WOPR:/opt/thedudeabides-store/storefront# docker ps | grep storefront                  de74cbdbc793   storefront-saleor-storefront              "docker-entrypoint.s…"   2 minutes ago    Up 2 minutes          0.0.0.0:3001->3000/tcp                           saleor-storefront                                           root@WOPR:/opt/thedudeabides-store/storefront#                                              root@WOPR:/opt/thedudeabides-store/storefront# # Check what port it's on                    root@WOPR:/opt/thedudeabides-store/storefront# ss -tlnp | grep -E '3000|3001'               LISTEN 0      4096         0.0.0.0:3001       0.0.0.0:*    users:(("dockerd",pid=194891,fd=147))                                                                                                                                      LISTEN 0      128        127.0.0.1:13000      0.0.0.0:*    users:(("sshd",pid=352726,fd=5))                                                                                                                                           root@WOPR:/opt/thedudeabides-store/storefront#                                              root@WOPR:/opt/thedudeabides-store/storefront# # Test it                                    root@WOPR:/opt/thedudeabides-store/storefront# curl -I http://127.0.0.1:3001/               HTTP/1.1 307 Temporary Redirect               Vary: RSC, Next-Router-State-Tree, Next-Router-Prefetch, Next-Router-Segment-Prefetch, Accept-Encoding                                    x-nextjs-cache: HIT                           x-nextjs-prerender: 1                         location: /default-channel                    x-nextjs-stale-time: 4294967294               X-Powered-By: Next.js                         Cache-Control: s-maxage=31536000              ETag: "tdpx9q3tt15rr"                         Content-Type: text/html; charset=utf-8        Content-Length: 7479                          Date: Sun, 30 Nov 2025 01:27:34 GMT           Connection: keep-alive                        Keep-Alive: timeout=5                                                                       root@WOPR:/opt/thedudeabides-store/storefront#                                              root@WOPR:/opt/thedudeabides-store/storefront# # Check the site through Cloudflare          root@WOPR:/opt/thedudeabides-store/storefront# curl -I https://dudeabides.wopr.systems/     HTTP/2 307                                    date: Sun, 30 Nov 2025 01:27:38 GMT           content-type: text/html; charset=utf-8        cache-control: s-maxage=31536000              nel: {"report_to":"cf-nel","success_fraction":0.0,"max_age":604800}                         location: /default-channel                    vary: RSC, Next-Router-State-Tree, Next-Router-Prefetch, Next-Router-Segment-Prefetch, Accept-Encoding
via: 1.1 Caddy                                x-nextjs-cache: HIT                           x-nextjs-prerender: 1                         x-nextjs-stale-time: 4294967294               x-powered-by: Next.js                         report-to: {"group":"cf-nel","max_age":604800,"endpoints":[{"url":"https://a.nel.cloudflare.com/report/v4?s=DU3EYcaldDrzZtZhnQa%2FBMabCAk467M84z4dosuGG1smYqw9grua5TcYZq%2FK%2FLVCNGjGJx327%2BFq1mnS4yseGrYXSdO9o%2BYwklKEOmDCys8abybwsWQf"}]}                                      cf-cache-status: DYNAMIC                      server: cloudflare                            cf-ray: 9a6690436d7bc067-HEL                                                                root@WOPR:/opt/thedudeabides-store/storefront# # Check what channels exist                  root@WOPR:/opt/thedudeabides-store/storefront# curl -s -X POST https://dudeabides.wopr.systems/graphql/ \                                 >   -H 'Content-Type: application/json' \     >   -H "Authorization: Bearer lethwrqrb5ur5MPtLwzemb68OgSPGX" \                             >   -d '{"query": "query { channels { id slug name } }"}'                                   {"data": {"channels": [{"id": "Q2hhbm5lbDox", "slug": "default-channel", "name": "Default Channel"}, {"id": "Q2hhbm5lbDoy", "slug": "the-dude-abides-shop", "name": "The Dude Abides Shop"}]}, "extensions": {"cost": {"requestedQueryCost": 1, "maximumAvailable": 50000}}}root@WOPR:/opt/thedudeabides-store/storefront#        root@WOPR:/opt/thedudeabides-store/storefront# # Check what products exist and their channelroot@WOPR:/opt/thedudeabides-store/storefront# curl -s -X POST https://dudeabides.wopr.systems/graphql/ \                                 >   -H 'Content-Type: application/json' \     >   -H "Authorization: Bearer lethwrqrb5ur5MPtLwzemb68OgSPGX" \                             >   -d '{"query": "query { products(first: 5) { edges { node { id name channelListings { channel { slug } isPublished } } } } }"}'        {"data": {"products": {"edges": [{"node": {"id": "UHJvZHVjdDox", "name": "Snapback Hat", "channelListings": [{"channel": {"slug": "default-channel"}, "isPublished": true}]}}]}}, "extensions": {"cost": {"requestedQueryCost": 15, "maximumAvailable": 50000}}}root@WOPR:/opt/thedudeabides-store/storefront#                    root@WOPR:/opt/thedudeabides-store/storefront#                                              root@WOPR:/opt/thedudeabides-store/storefront#                                              root@WOPR:/opt/thedudeabides-store/storefront# # 1. PUBLISH SNAPBACK HAT TO "the-dude-abides-shop" CHANNEL                                root@WOPR:/opt/thedudeabides-store/storefront# curl -s -X POST https://dudeabides.wopr.systems/graphql/ \                                 >   -H 'Content-Type: application/json' \     >   -H "Authorization: Bearer lethwrqrb5ur5MPtLwzemb68OgSPGX" \                             >   -d '{                                     >     "query": "mutation { productChannelListingUpdate(id: \"UHJvZHVjdDox\", input: { updateChannels: [{ channelId: \"Q2hhbm5lbDoy\", isPublished: true, visibleInListings: true, isAvailableForPurchase: true }] }) { errors { field message } } }"                                >   }'                                        {"data": {"productChannelListingUpdate": {"errors": []}}, "extensions": {"cost": {"requestedQueryCost": 0, "maximumAvailable": 50000}}}root@WOPR:/opt/thedudeabides-store/storefront#   root@WOPR:/opt/thedudeabides-store/storefront# # 2. ENABLE VARIANTS ON THE PRODUCT TYPE     root@WOPR:/opt/thedudeabides-store/storefront# # First, check the current product type configuration                                      root@WOPR:/opt/thedudeabides-store/storefront# curl -s -X POST https://dudeabides.wopr.systems/graphql/ \                                 >   -H 'Content-Type: application/json' \     >   -H "Authorization: Bearer lethwrqrb5ur5MPtLwzemb68OgSPGX" \                             >   -d '{"query": "query { productTypes(first: 10) { edges { node { id name slug hasVariants variantAttributes { id name slug } productAttributes { id name slug } } } } }"}'           {"data": {"productTypes": {"edges": [{"node": {"id": "UHJvZHVjdFR5cGU6MQ==", "name": "Default Type", "slug": "default-type", "hasVariants": false, "variantAttributes": [], "productAttributes": []}}]}}, "extensions": {"cost": {"requestedQueryCost": 20, "maximumAvailable": 50000}}}root@WOPR:/opt/thedudeabides-store/storefront#                                          root@WOPR:/opt/thedudeabides-store/storefront# # 3. UPDATE THE PRODUCT TYPE TO SUPPORT VARIANTS (if hasVariants is false)                 root@WOPR:/opt/thedudeabides-store/storefront# curl -s -X POST https://dudeabides.wopr.systems/graphql/ \                                 >   -H 'Content-Type: application/json' \     >   -H "Authorization: Bearer lethwrqrb5ur5MPtLwzemb68OgSPGX" \                             >   -d '{                                     >     "query": "mutation { productTypeUpdate(id: \"UHJvZHVjdFR5cGU6MQ==\", input: { hasVariants: true }) { productType { id hasVariants } errors { field message } } }"                 >   }'                                        {"data": {"productTypeUpdate": {"productType": {"id": "UHJvZHVjdFR5cGU6MQ==", "hasVariants": true}, "errors": []}}, "extensions": {"cost": {"requestedQueryCost": 0, "maximumAvailable": 50000}}}root@WOPR:/opt/thedudeabides-store/storefront#                                     root@WOPR:/opt/thedudeabides-store/storefront# # 4. CHECK WHAT ATTRIBUTES EXIST FOR VARIANTSroot@WOPR:/opt/thedudeabides-store/storefront# curl -s -X POST https://dudeabides.wopr.systems/graphql/ \                                 >   -H 'Content-Type: application/json' \     >   -H "Authorization: Bearer lethwrqrb5ur5MPtLwzemb68OgSPGX" \                             >   -d '{"query": "query { attributes(first: 20) { edges { node { id name slug inputType } } } }"}'                                       {"data": {"attributes": {"edges": [{"node": {"id": "QXR0cmlidXRlOjI=", "name": "Color", "slug": "color", "inputType": "DROPDOWN"}}, {"node": {"id": "QXR0cmlidXRlOjE=", "name": "Size", "slug": "size", "inputType": "DROPDOWN"}}]}}, "extensions": {"cost": {"requestedQueryCost": 20, "maximumAvailable": 50000}}}root@WOPR:/opt/thedudeabides-store/storefront#              root@WOPR:/opt/thedudeabides-store/storefront# # 5. CHECK WHAT WAREHOUSES EXIST (needed for variant stock)                                root@WOPR:/opt/thedudeabides-store/storefront# curl -s -X POST https://dudeabides.wopr.systems/graphql/ \                                 >   -H 'Content-Type: application/json' \     >   -H "Authorization: Bearer lethwrqrb5ur5MPtLwzemb68OgSPGX" \                             >   -d '{"query": "query { warehouses(first: 10) { edges { node { id name slug } } } }"}'   {"data": {"warehouses": {"edges": [{"node": {"id": "V2FyZWhvdXNlOjA4NjdhNzM5LThjYjQtNDlkNy1hNDdjLWJkODJkYTRiMDI2ZQ==", "name": "Default Warehouse", "slug": "default-warehouse"}}]}}, "extensions": {"cost": {"requestedQueryCost": 10, "maximumAvailable": 50000}}}root@WOPR:/opt/thedudeabides-store/storefront#                root@WOPR:/opt/thedudeabides-store/storefront# # 6. VERIFY PRODUCT IS NOW IN the-dude-abides-shop CHANNEL                                 root@WOPR:/opt/thedudeabides-store/storefront# curl -s -X POST https://dudeabides.wopr.systems/graphql/ \                                 >   -H 'Content-Type: application/json' \     >   -d '{"query": "query { products(first: 5, channel: \"the-dude-abides-shop\") { edges { node { id name } } } }"}'                      {"data": {"products": {"edges": []}}, "extensions": {"cost": {"requestedQueryCost": 5, "maximumAvailable": 50000}}}root@WOPR:/opt/thedudeabides-store/storefront#                       root@WOPR:/opt/thedudeabides-store/storefront# # 7. UPDATE PRINTFUL-SYNC TO USE THE CORRECT CHANNEL                                       root@WOPR:/opt/thedudeabides-store/storefront# # First check the current channel configuration                                            root@WOPR:/opt/thedudeabides-store/storefront# grep -n "channel\|Channel\|Q2hhbm5lbDo" /opt/printful-sync/app.py
218:    # Assign to channel
220:    mutation ($id: ID!, $input: ProductChannelListingUpdateInput!) {                    221:      productChannelListingUpdate(id: $id, input: $input) {                             231:                "updateChannels": [{      232:                    "channelId": "Q2hhbm5lbDox",                                        259:                "channelListings": [      261:                        "channelId": "Q2hhbm5lbDox",                                    291:                "updateChannels": [{      292:                    "channelId": "Q2hhbm5lbDox",                                        root@WOPR:/opt/thedudeabides-store/storefront#                                              root@WOPR:/opt/thedudeabides-store/storefront#